航空工艺技术
AERONAUTICAL MANUFACTURING TECHNOLOGY
1999年　第3期　No.3 1999



三牙轮钻头工艺图自动生成系统
The Operation Sketch Generating System for Tri_Cone Rock Bit
郑联语　杜　裴
　　［摘要］　介绍了三牙轮钻头工艺图自动生成系统的结构和功能，论述了工艺图信息模型和工艺图自动生成的的工作原理，提出了综合参数化特征组合和样板图尺寸置换2种方法自动生成工艺图的方法。
　　关键词： CAPP　工艺图　工序特征　三牙轮钻头

　　［ABSTRACT］　This paper introduces the structure and functions of the operation sketch generating system for tri_cone rock bit. The information model of operation sketch and the principle of automatically generating operation sketch are discussed. A synthetical approach to combine parametric features and to substitute the dimensions of template sketch is presented.
　　Keywords: CAPP　Operation sketch　Operation feature　Tri-cone rock bit

　　工艺图自动生成是计算机辅助工艺设计CAPP(Computer Aided Process Planning)系统的一项重要任务，也是CAPP的技术难点之一。将工艺图生成的一般原理与具体产品的制造工艺特点相结合，同时借助商用图形系统为平台，可以有效地自动生成工艺图，大大提高自动工艺设计效率。三牙轮钻头工艺图自动生成系统(JZCAPP-DRAW)就是我们按照上述思想开发的，它是JZCAPP系统总控流程控制下的一个子系统［1］，能完成产品图纸信息的输入，计算工艺尺寸，自动生成和交互编辑牙轮和牙掌的全部工序图。该系统采用CAD图形软件MicroStation作为开发与使用平台，是使用MicroStation提供的二次开发语言MDL(MicroStation Development Language)开发的应用程序，具有原系统同样的风貌，能完全融入原系统中，使用方便。系统的主要特色是综合参数化特征组合和样板图尺寸置换2种方法自动生成工艺图，能以不同颜色分层叠加任意工序的工艺图(前者生成的)，从而能方便地检查加工余量的大小及其分布的合理性。

1　系统结构与功能
　　JZCAPP-DRAW系统结构如图1。带方框的功能菜单项另有子项，因篇幅限制未展开。


图1　系统结构
Fig.1　Structure of the system
1.1　文件功能(File)
　　完成系统所产生的数据文件的装载、保存和查阅(浏览)。其中，产品图尺寸信息文件(PAT File)和工艺图尺寸信息文件(OPR File)分别用于以特征为单元存取产品图和工艺图的尺寸信息；图形元素信息文件(DXF File)用于按DXF格式存取图形(包括产品图和工艺图)的几何元素信息，便于数据交换；文件浏览(Browse)用于浏览数据文件的内容。
1.2　输入功能(Input)
　　完成产品信息的输入。其中，总体信息(Overall Info)读入产品总体信息，包括类型、名称、型号、图号、轴承号、材料规范号、锁紧方式、过程卡编号等，已由工艺设计时输入，这里直接读取；毛坯(锻件)信息(ForgeInfo)读入或输入毛坯(锻件)信息；形状特征(Features)用于交互输入产品的形状特征信息。利用特征参数对话框同时结合特征参考文件(即特征图)可方便地输入产品的几何信息，构成产品的各种不同特征，通过特征菜单或特征图标(由Palette/Open打开)选取。三牙轮钻头的特征主要包括：大(小)轴颈、大(小)轴承孔、储油孔、水孔、齿孔、定位孔、塞销孔、密封面、(卡簧/钢球)锁紧槽、油槽、合金槽等。
1.3　生成功能(Generate)
　　系统的核心部分。其中，装载工艺过程信息(Load Plan)读入工艺过程信息(由工艺设计产生)；计算工艺尺寸(Calculate)确定(计算/选择)工艺尺寸；连续生成全部工序图(Draw All)用于一次性连续生成全部工序图；生成指定工序图(Draw Single)用于有选择地生成某指定工序图(主要用于工序间的加工余量检查)。
1.4　编辑功能(Edit)
　　完成工序图的特征编辑、图形元素编辑、图形元素特性修改。其中，选择工序图文件(DGN File)选择并调入特定工序的工艺图；特征编辑(Feature)以特征为单元对特征进行删除、移动和复制操作；图形元素编辑(Element)对构成工艺图的元素(点、直线段、圆、圆弧、文本、尺寸)进行删除、移动和复制操作；图形元素特性修改(Properties)用于更改图形元素的特性(即颜色、线型、线宽等属性)。
　　此外，调色板图标功能(Palette)用于打开和关闭特征图标调色板。每种形状特征对应一个特征图标。选取某特征图标与选取对应的特征菜单效果相同。

2　工艺图信息模型
　　为描述工艺图的动态变化过程，每个工序都由一个工序特征(OprFeature)集合记录构成该工艺图的所有特征信息，包括特征数目、类型、尺寸参数、方位及加工状态等。随着加工过程的进行，工序特征集的内容渐进变化，工艺过程结束时，最终工序的工序特征集特征数目恒等于零件特征数目，所有特征的工艺尺寸与设计尺寸相同。
　　为便于对工艺图的操作及其信息的管理，工艺图的信息分两部分组织：一部分为图形的高层信息，即工序特征集合，以特征为单元记录工艺图的所有工序特征及相关尺寸。高层信息以OPR文件格式存取，供生成特征图和选择(或设计)工装(刀、夹、量具)用；另一部分为图形的低层信息，即图形元素集合，以元素为单元记录工艺图所有图形元素(直线段、圆弧、圆等)的几何信息。低层信息以DXF文件格式存取，供产生工程图以及与其他CAD系统进行数据交换用。工艺图的高低两层信息，既保持相对独立又通过工序特征建立联系。工艺图信息模型可概括如下。
　　高层工序特征信息：
typedef struct oprSketchInfo｛
　　int oprNo;　　　　　　 ∥工序号(代码)
　　char*oprName;　　　　　∥工序名称
　　char*oprSkhNo;　　　　∥工序图号
　　int status;　　　　　　∥生成状态标志
　　char*templateRef;　　　∥所参考样板图名
　　　　　　　　　　　　　∥空值表示无参考
　　int featNum;　　　　　∥工序特征数目
　　OprFeature features［］;∥工序特征表
｝OprSketch;
typedef struct oprFeatureInfo｛
　　int featNo;　　　　　　∥特征号(类型编码)
　　int machined;　　　　　∥加工状态标志
　　char*featName；　　　　∥特征名称
　　Point location;　　　　∥位置信息
　　Placement orientation;∥方向(姿态)信息
　　int featParamNum;　　　∥特征参数数目
　　DimType featParams［］；∥特征参数表
　　ElementNode*　featElemP;∥特征图形元素头指针
｝OprFeature；
　　低层图形元素信息：
　　typedef struct elemInfoNode｛
　　int elementType;　　　　　∥图形元素类型
　　Element elemInfo;　　　　∥图形元素信息
　　struct elemInfoNode*　link;∥元素链表指针
｝elementNode;
typedef union elementUnion｛
　　Point point;　　　　　∥点
　　Line line;　　　　　　∥线段
　　Arc arc;　　　　　　　∥圆弧
　　Circle circle;　　　　∥圆
　　Text text;　　　　　　∥文本
　　Dimension dim;　　　　∥尺寸
｝Element；

3　工艺图自动生成原理
　　工艺图自动生成过程如图2所示，分为4个阶段，即输入产品信息(包括总体、形状特征与工艺过程3方面信息)、确定工艺尺寸、生成工艺图和编辑工艺图。


图2　工艺图自动生成工作原理
Fig.2　Working principle of operation sketch generating system
3.1　确定工艺尺寸
　　对于任意工序、工艺尺寸的确定过程如下：
　　(1)继承上道工序的工艺尺寸(即工序特征集)。
　　(2)计算或选择本工序的工艺尺寸。分3种情形：若为现有产品，则从工艺数据库中选择该产品相应工序的工艺尺寸；若为新产品且与现有产品类似，即只有少数尺寸变化且变化值在规定范围内，则最终工序(精加工)的工艺尺寸取产品尺寸，而其他工序则取类似产品的相应工序的工艺尺寸(目的是减少专用工装)；若为新产品，则按余量规则和经验公式计算工艺尺寸。
　　(3)根据加工内容更新工序特征集。
　　(4)生成工艺图尺寸信息文件(工艺图号.OPR)。
3.2　生成工艺图
　　生成工艺图采用参数化特征组合和样板图尺寸置换2种方法。
　　(1)若工艺图尺寸和拓扑结构都变化(如牙轮轴承孔和牙掌轴颈工艺图)，则采用参数化特征组合的方法，即调用特征图生成子程序经过精确的几何交切处理生成各特征图，工序特征集中所有特征图都生成后便组合成工艺图，并自动标注工艺尺寸。这种方法灵活性好，能充分满足工艺图动态变化的要求。
　　(2)若工艺图只有尺寸变化而拓扑结构不变(如牙掌外形、水孔和储油孔工艺图)，则采用样板图尺寸置换的方法。该方法的原理是，先根据工序代码和零件总信息确定复制工艺样板图库中某个样板图。在样板图中，充分表示了加工部位的结构形状，标注了工艺尺寸符号(如某直径尺寸用D表示)，但不是具体尺寸值，且须保证同一样板图中各尺寸符号唯一。这时得到的当前工序的工艺图与样板图完全一致，并没有标注该工序的实际工艺尺寸(只有尺寸名称或代码)。再自动搜索工艺图中所有尺寸符号并用相应工序的工艺尺寸(前面已确定并存储)替换之，便得到所需工艺图。为保证尺寸置换正确无误，关键是需预先建立工艺样板图尺寸符号与工序特征参数的对应关系参照表。这种方法简便实用，效率高。
3.3　编辑工艺图
　　自动生成的工艺图可交互进行局部编辑修改和余量检查。
　　图形编辑：首先通过DGN File打开工序代码和工艺图号列表窗口，从中选择某工艺图。然后利用特征编辑、元素编辑和元素特性更改3种手段对工艺图进行编辑修改。图形编辑还可充分利用MicroStation本身提供的功能。
　　余量检查：对于由参数化特征组合方法生成的工艺图，可直接调入或重新生成(Draw Single)两道或多道工序的工艺图，对齐基准面，并以不同颜色分层叠加，从而能方便地检查加工余量的大小及其分布的合理性。
　　最终得到的工艺图以MicroStation图形文件形式存储，并可随时由绘图机输出。

4　结束语
　　(1)实际应用表明，本系统能较好地满足企业的生产要求，大大提高了工艺设计效率。
　　(2)本系统的结构及采用的原理和方法具有一定的通用性，不仅适用于三牙轮钻头产品，而且可用于工艺特点类似的其他产品，我们将对此作进一步的研究与应用开发。
作者单位：北京航空航天大学
参考文献
　　1　郑联语，王庆文，杜裴.三牙轮钻头CAPP系统.机械工业自动化，1997，19(3)：8～12
　　2　唐荣锡.CAD/CAM技术.北京：北京航空航天大学出版社，1994
(责编　朝　晖)　
