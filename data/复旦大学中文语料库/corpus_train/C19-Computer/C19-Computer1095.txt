自动化学报
AGTA AUTOMATICA SINICA
1999年 第25卷 第2期 Vol.25 No.2 1999



多坐标曲面加工中进给速度的优化控制1)
周艳红　周　济　周云飞
摘　要　介绍了基于曲面CNC(Computer Numerical Control)直接插补方式的多坐标曲面加工中进给速度的控制原理.综合考虑刀具相对零件表面切削进给速度的恒定，曲面形状引起的各运动轴速度及其变化率不超过伺服驱动能力，以及机床在启动、停止和速度变化时的平滑加减速运动控制等因素，实现了进给速度的合理确定与控制，可有效提高曲面加工质量和加工效率.
关键词　CNC，曲面加工，进给速度，多坐标.
OPTIMAL FEEDRATE CONTROL FOR MULTI-AXIS CNC
MACHINING OF FREE FORM SURFACES
ZHOU Yanhong　ZHOU Ji　ZHOU Yunfei
(Huazhong Univ.of Science and Technology,Wuhan　430074)
Abstract　The principle of feedrate control for multi-axis CNC machining of free-form surfaces is presented.The effective feedrate determination and control are implemented by synthesizing the following factors:a.constant feedrate of cutting point of cutter relative to part surface; b.the velocity and its changing rate of each movement axis not beyond the actuator limitation;c.smooth transition when the feedrate needs to change and during the period of machine start or stop.As a result,the machining quality and efficiency are improved effectively.
Key words　CNC, surface machining, feedrate, multi-axis.
1　引言
　　进给速度的大小不仅决定了加工效率，而且对表面质量有着重要的影响，同时，进给速度的剧烈变化还将严重影响刀具寿命.因此，应尽可能保持高速且稳定的恒表面进给速度(即刀具切削部位相对加工表面的进给速度).但另一方面，由于曲面形状复杂，恒表面的进给速度必将导致机床各坐标轴运动速度的不断变化，若由此引起的坐标轴运动速度过高或速度变化过大时，将产生较大的几何轨迹误差.此外，由于机械运动部件存在惯性，在机床的启动、停止和速度变化时都必须以平滑的速度过渡，防止产生运动冲击而影响加工精度、机床和刀具的寿命.因此，进给速度又必须根据曲面形状和机床动力特性对指令速度给予必要的修调，并在速度需要变化时采取合适的速度曲线实现平滑过渡.
　　然而，目前基于离线编程的曲面加工在进给速度控制方面尚存在一些不足：1)编程方面，进给速度一般按刀具在偏置曲面上匀速进给来确定，刀具相对于加工表面的实际合成切削速度并不恒定，且很少考虑根据曲面形状和实际机床力学特性来确定合适的进给速度曲线；2)在CNC控制方面，由于曲面加工被离散成一系列小直线或圆弧段指令执行，CNC系统只是忠实地执行各程序段的指令进给速度，微线段引起的频繁加减速使进给速度难以保持稳定，平均速度也难以达到指令速度［1－4］.
　　作者及课题组成员研制了具有曲面直接插补能力的CNC系统［5］.在进给速度控制方面，该系统可综合考虑刀具相对零件表面进给速度的恒定、曲面形状引起的各运动轴速度及其变化率不超过伺服驱动能力、以及机床在启动、停止和速度变化时的平滑加减速控制等因素，实现进给速度的合理确定与控制.
2　基本方案
　　进给速度控制的目标是要在保证动态轨迹精度和加工表面质量的同时实现高效的切削进给运动，它包括两方面内容：1)确定随加工轨迹变化的有效进给速度曲线；2)采取合适的策略实现进给速度曲线的平滑控制.曲面CNC直接插补加工系统中所采取的进给速度控制方案如图1所示.



图 1　进给速度控制方案
3　机床运动轨迹的生成
　　设曲面参数方程为rs=rs(u,w),各种加工方式的切削行走刀路径可用参数方程统一表示为rs(t)=rs(u(t),w(t)).如图2所示，对于球头刀、平底刀、环形刀和鼓形刀等常用刀具五坐标联动加工，工件坐标系中刀具沿rs(t)进行接触切削的刀具运动可统一表达为

(1)
式中，R1,R2为刀具参数；n(t)为曲面上切削点处单位法矢；a(t)为曲面上切削点处沿进给方向单位切矢；v(t)=n(t)×a(t);前导角α和倾斜角γ为局部坐标系(a(t),v(t),n(t))下的一般刀轴控制方式角；i(t)为刀轴单位矢量；rδ(t)=b.n(t)为余量补偿矢量，b为沿零件面法向度量的保留加工余量；rc(t)为刀具偏置矢量；rp(t)为刀位点p的位置矢量；ri为刀具干涉存在时的补偿矢量.式(1)虽为五轴加工刀位表达，但只要令刀轴方向矢量i(t)在工件坐标系中固定为(0，0，1)，即转化为三轴加工的刀位计算表达.


图 2　刀具双摆动五轴加工
　　对于图 2 所示刀具双摆动五坐标系统，设A轴装在B轴上，A、B轴垂直相交，B轴和A轴的旋转运动分别为φ(t)和θ(t)，且机床平动可视为om的运动，记其为rm(t)=(xm(t),ym(t),zm(t))，并设初始状态下φ(t)和θ(t)为零，A、B轴分别平行于x轴和z轴，则

(2)

(3)
式中(ix(t),iy(t),iz(t))为刀轴方向矢量i(t)在工件坐标系中的各坐标分量，ro为工件坐标系原点在机床坐标系中的位矢；l.i(t)为机床旋转运动引起的附加平动矢量，l为刀位点p至摆心om的距离.
　　式(2)，(3)给出了图2所示五坐标机床各坐标轴理想的连续运动，由于CNC只能离散处理，因此，机床运动轨迹的生成也即是要寻求切削行参数t的一个满足轨迹逼近精度要求的分割(t0,t1,…)，并由rs(t)的数学表达和由式(1)-(3)计算该参数分割上的离散刀具接触点数据rs(tk)、刀位数据(i(tk),rp(tk))和机床坐标轴运动数据(Δrm(tk),Δφ(tk),Δθ(tk)),其中k=0,1，….在该离散分割的各相邻点之间机床各轴均以线性规律运动，从而构成一线性程序段集合.记Δrsk=rs(tk+1)-rs(tk),Δrmk=rm(tk+1)-rm(tk),Δφk=φ(tk+1)-φ(tk),Δθk=θ(tk+1)-θ(tk),其中k=0,1，…，则Δrsk和(Δrmk,Δφk,Δθk)分别为第k个线性程序段G01k中的刀具接触点位移增量和机床各运动轴的位移增量.
4　有效进给速度曲线的确定
4.1　保证恒表面切削进给的各运动轴速度
　　各程序段中各坐标轴运动的合成应尽量保证刀具相对于零件表面的切削进给(即刀具接触点的运动)速度恒定，且等于指令进给速度.
　　为保证恒表面切削进给，在生成各程序段位移数据的同时，直接根据其对应的刀具接触点位移增量和指令进给速度生成该程序段的各坐标轴运动速度.对于程序段G01k，其机床各坐标轴(X，Y，Z，A，B)的位移增量为(Δxmk,Δymk,Δzmk,Δθk,Δφk)，对应刀具接触点位移增量为Δrsk，指令进给速度为Fk，则该程序段内机床各轴的运动速度(FXk,FYk,FZk,FAk,FBk)为

(4)
　　显然，由式(4)确定的机床各轴运动的合成将保证刀具切削点相对零件表面以指令进给速度Fk运动.
4.2　进给速度的限制
　　在曲面的大曲率部位，刀轴矢量i(t)将发生明显变化，由式(1)-(4)可知，这不仅使旋转/摆动轴速度及其变化率增大，更为严重的是由于摆动半径l大，机床旋转/摆动引起的附加平动l.Δik以及曲面形状本身的影响可能导致机床平动轴速度及其变化率过大(凹曲面加工时则可能使平动速度极小).因此，为保证动态轨迹精度及机床正常运行，需根据机床动力特性和伺服驱动能力自动对指令进给速度Fk进行修调.
　　1)运动轴最大速度限制
　　各程序段内机床各坐标轴的运动速度须小于其最大允许速度，即由式(4)确定的各运动轴速度需满足

(5)
　　当任一运动轴速度不满足式(5)时，需以保证刀具运动轨迹不变为原则对各坐标轴速度进行修正，亦即对合成切削速度Fk进行修正.例如，若X轴速度超过其设定的最大允许速度FXmax，则合成切削速度Fk需修正为

(6)
　　2)程序段转接处最大速度变化限制
　　由式(4)可知，由于相邻两线性程序段合成切削进给速度的方向要发生改变，大小也可能变化，因而各运动轴的速度大小甚至方向将随之产生突变.为保证轨迹精度并避免机床产生冲击，程序段转接点(即相邻直线段交点)处各运动轴的速度变化率不能超过该轴的伺服驱动能力.设第k程序段与第k-1程序段的转接点处的合成切削速度大小为Fkj，各坐标轴在第k程序段的起点处(体现为第一个插补周期)运动速度记为FΛkb，在第k-1段的终点处(体现为最后一个插补周期)运动速度记为FΛ(k-1)e，则该相邻两插补周期的各坐标轴速度变化需满足

(7)
其中，aΛmax为各坐标轴伺服驱动允许的最大加/减速度，Ts为CNC系统插补周期.转接点处合成切削速度Fkj首先设置为与当前段的指令速度Fk相同，但若式(7)不满足时，则应根据式(4)对Fkj进行限制.例如，若X轴不满足式(7)，则Fkj应修正为

(8)
　　3)减速程序段最大首尾速度变化限制
　　设环形缓冲区中包含当前n个线性程序段

其中Fk,Fkj,F(k+1)j分别为程序段G01k的指令速度、起点速度(即与G01k-1的转接点速度)和终点速度(即与G01k+1的转接点速度)，且均已经过上述步骤处理.对于任一程序段G01k，若其起点速度Fkj大于其终点速度F(k+1)j，则该程序段为减速程序段，由于程序段长度｜Δrsk｜有限，其起点速度到终点速度的变化量必须在机床伺服驱动能力允许的范围内，否则，需对其起点速度进行限制(因不能提高终点速度).设减速过程按指数规律变化，则从Fkj减速到F(k+1)j所需的减速距离为

(9)
式中τ为按合成切削进给方向Δrsk进行加减速的工艺系统综合时间常数，可取为各运动坐标轴时间常数的最大值.显然，减速距离Sk应小于该程序段的刀具接触点位移增量Δrsk.否则，该程序段起点速度Fkj应修正为

(10)
　　上述限制原则按从后向前的顺序(即G01n→G01n-1→…→G012)逐段检测并修正各程序段的起点速度值，直到有一程序段不满足该条件，由此可实现减速距离限制的提前预测，保证平稳的机床运动控制.从该过程可以看出，环形缓冲区的长度应满足：按最后一段G01n为轨迹终点作为控制条件时，应不致对第一段(即当前运动段G011)的速度指令产生影响.
5　进给速度的平滑控制
　　由上述分析可知，由于零件形状、机床动力特性和伺服驱动能力以及机床启动、停止的影响，机床运动速度要发生变化，此时需采取合适的加减速措施实现速度的平滑过渡，以防止机床的冲击，影响加工精度和寿命.
　　经过处理，得到了随加工轨迹变化的有效速度曲线，各程序段的起、终点速度和有效指令进给速度均已获得.在此基础上，本系统采用平滑性较好的指数规律实现切削过程中加工进给速度的加减速控制，并按合成进给切削速度进行控制，以保证加减速过程中刀具相对零件表面的运动轨迹，提高加工精度和表面质量.
　　由图1可知，速度平滑的加减速控制与轨迹插补输出是对环形缓冲区中的当前运行段G011进行操作.该工艺系统机械时间常数为τ，程序段指令进给速度为F1，起始点速度为F1j，终止点速度为F2j，则从起始速度F1j按指数规律加速到指令速度F1的速度变化曲线为

(11)
而从当前速度Fq按指数规律减速到程序段终点速度F2j的速度变化曲线为

(12)
　　由于CNC是以一定的插补周期Ts在时刻t=Ts,2Ts,3Ts,…对上述加减速过程进行离散采样控制，且其中C=e-Ts/τ为常数，故加减速过程的速度变化可用递推计算而避免指数运算，在此基础上使速度依次递增或递减即可.对于任意插补周期q,要开始减速的条件是当前速度Fq大于程序段终点速度F2j，且本程序段所剩长度Lq已小于从Fq减速到F2j所需的减速距离Sq，由式(9)可知Sq=(Fq-F2j).τ，因此可得指数加减速处理算法.
　　设当前运行段G011内第q个插补周期的进给速度为Fq，则第q+1个插补周期的进给速度Fq+1为

其中Fm为允许的启动/停止突变速度.在求得第q+1个插补周期的合成进给速度Fq+1后，即可由式(4)确定各坐标轴的运动速度，从而得到并输出各坐标轴的插补周期进给增量.
6　结果与分析
　　上述基于曲面CNC直接插补方式的进给速度处理方法已在自行开发的基于PC的CNC系统中实现，在对洗衣机波轮、鼓风机叶片及增压器整体叶轮等复杂曲面零件的实际加工中获得了良好的效果，其有效性可由以下实验结果说明.图3所示为五轴双摆动机床加工某曲面的一切削行走刀路径及相应的刀具运动轨迹，有关参数设置为：平动轴最大速度100mm/s，最大加速度120mm/s2；转动轴最大速度3r/s，最大加速度4r/s2；时间常数0.2s，系统插补周期0.008s.当轨迹离散逼近精度为0.005mm、指令进给速度为20mm/s时，采用一般CNC的进给速度控制方法(对各线性程序段均进行升、降速处理)插补输出的合成进给速度曲线如图4所示，共需加工时间为161.04s.而采用本文的方法插补输出的表面进给速度曲线如图5所示，除了在轨迹剧烈变化的局部对指令速度进行了修调外，绝大部分均稳定为指令速度，仅需加工时间30.63s.

图 3　加工实例

图 4　一般方法处理结果

图 5　本文方法处理结果
　　可见，本文给出的方法从复杂曲面加工轨迹整体上实现了进给速度的平稳控制和高速加工时减速距离的提前预测与控制，这对于提高曲面加工质量、加工效率，并保证机床在正常状态下运行具有重要意义.
1)国家“八五”科技攻关专题(85-719-02-01)、国家自然科学基金(59445015)资助.
作者简介：周艳红　1966年生.1986年毕业于华中理工大学机械制造专业，1989年获工学硕士学位，1997年获工学博士学位，现为华中理工大学副教授.主要研究领域为数控技术与CAD/CAM，发表论文30余篇.
　　　　　周　济　1946年生.1970年毕业于清华大学机械制造专业，1984年于美国纽约州立大学(法布罗)获博士学位，现为华中理工大学教授.在机械设计和数控加工技术方面进行了系统深入的研究工作，取得了重要成果.先后获科技成果奖 22 项，出版专著10本，发表论文300余篇.
　　　　　周云飞　见本刊 22 卷 5 期 560 页.
作者单位：华中理工大学机械学院　武汉　430074
参考文献
1　Shpitalni M.Koren Y,Lo C C.Real-time curve interpolator.Computer-Aided Design,1994,26(11):832-838
2　Daniel C H Yang,Tom Kong.Parametric interpolator versus linear interpolator for precision CNC machining.Computer-Aided Design,1994,26(3):225-234
3　Dimitris Kiritsis.High precision interpolation algorithm for 3D parametric curve generation.Computer-Aided Design,1994,26(11):850-855
4　Vickers G W,Bradley C.Curved Surface machining through circular arc interpolation.Computers in industry,1992,19:(3)329-337
5　周艳红，周云飞，周济.CNC系统中曲面交线加工刀具轨迹直接插补.自动化学报，1996，22(5)：554－560
收稿日期　1997-10-27
收修改稿日期　1998-03-05
