微型机与应用
WEIXINGJI YU YINGYONG
1999年3月 第18卷 第3期 vol.18 No.3



Internet电话网关技术及实现策略
黄永峰　冯丹　张江陵
　　摘　要：阐述了Internet电话连接方式以及Internet电话网关的关键技术问题。最后介绍了Internet电话网关的实现策略。
　　关键词：Internet电话网关　G723.1　H.323　回声消除
　　Internet电话就是在Internet上可通过TCP/IP协议实现实时传送语音的一种新型电信业务，是近年来人们研究的热点。据国际数据公司分析，Internet电话的市场业务量将从1995年的350万元上升到1999年的56?000万元。人们之所以对Internet电话抱着如此大的兴趣和保持如此乐观的态度，有2个关键的原因：(1)Internet电话在很大程度减少长途(国际、国内)电话费用；(2)Internet电话的使用，标志着一种全新的功能更强的通信方式的产生，从而可以打破电话公司的垄断市场。
　　目前，Internet电话的实现策略有如下3种方式：(1)PC机to PC机方式，该方案是在通信双方用户联网的PC机上配置1个声卡、话筒、扬声器和IP电话软件(如Netmeeting)，就可进行通话。IBM、微软、网景等公司都相继推出这种IP电话软件产品。(2)是Phone to Phone，即网关方式。该方案是在通信双方的局端设立所谓Internet电话网关，而在用户端，只需使用普通电话机，可通过Internet进行语音通信。随着技术的发展，网关方式是Internet电话的主要组成方式。连接方式如图1所示。(3)是PC机TO Phone方式。该方案是上述二种方式的混合方式，即通信双方一方采用PC机方式，另一方采用网关方式。下面主要介绍Internet电话网关的相关技术及实现策略。

图1  Interret电话网关的连接方式
1 Internet电话网关的关键技术
1.1　Internet电话与传统电话主要差异及Internet电话网关实现的功能
　　传统电话(PSTN)采用的是线路交换方式，通话的双方通过呼叫方式建立1条64kb/s带宽的物理链路，因此，能确保语音的实时传输和通信的同步。但是PSTN的线路交换链路一旦建立，无论双方是否通话，其链路始终保持，直至链路被拆除。Internet采取的是分组交换方式，其分组以存储器转发的机理在Internet节点间传输，分组在路由上传输的延迟是不确定的，它受Internet当前可用的传输带宽等因素的影响，因此不能提供可靠的实时传输。IP电话网关就是用来实现语音在这二种传输方式不同网络上的协议的转换，并确保语音数据在Internet实时传输。
　　IP电话网关是网络互联设备中的一种新型网关，它的一边连着传统的电话网，如公共交换电话网(PSTN)，通过交换机(PBX)可与外部的任意一部电话通信，网关的另一边连着Internet或Intranet。用户拔打长途电话时，网关接收电话语音信号，经数字化，形成A律/μ律的PCM码。再按H.323规定的压缩标准，如(G723.1、G729)进行数据压缩，再根据电话区号数据库资料确定相应网关的IP地址，然后使用IP协议和RTP协议将语音数据组装成分组、送到Internet，通过Internet传到对端网关；对端网关接到Internet传来的IP分组经解码处理，并还原为模拟语音信号转送PSTN系统。图2显示了语音数据在Internet电话网关中的转换过程。

图2  Interret电话网关中语音数据转换过程
1.2　Internet电话网关的关键技术
　　如何保证语音在Internet上的实时传输，以及如何提高Internet电话的服务品质(QoS)，是Internet电话网关必须解决的关键问题。为了实现这一点，Internet电话网关必须实现下列3个关键技术。
　　(1)语音延时的处理和回声消除技术
　　在Internet电话中，产生延迟的延迟源有3种，分别是语音压缩延迟、分组传输延迟和各种处理延迟。其中语音压缩延迟，可通过“回声消除”来解决，以防止产生回铃声和回响。回声消除的好坏在很大程度影响语音质量，因此，在Internet电话网关中，回声消除是一关键技术问题。目前，主要采用DSP处理器来实现AEC回声消除技术。传输延迟是光/电子的传输速度极限所致，这不是影响语音传输质量的主要因素。作为Internet电话最大的延迟是处理延迟，特别是网络发生堵塞时，数据在Internet上的处理延迟是相当可观的。据测试表明在INTERNET国际线路上的端到端的延迟甚至可达1s之多，因此处理延迟是影响Internet电话的关键因素。尤其严重的是处理延迟是产生抖动延迟的关键原因，抖动延迟将在发音之间产生随机中断。解决抖动延迟可以采取抑制缓冲技术，该技术是在每一个语音分组提供一个时间标记，以确保该分组发送到目标地址时，同其他语音元素的相对间隔与输入语音信号的间隔一致。例如在IP网络中传输语音时，该时间标记是由实时传输协议(RTP)提供的；另外也可以采用损耗(Loss)算法来处理延迟以保证语音质量。这种算法的基本原理是：一个模拟语音在发送端采用8位的2进制数进行模/数转换，在接收端再将二进制数转换为模拟波形。在还原原始波形时，这个2进制数中的8位数并非同等重要，例如：D7比D6重要，D6比D5重要，D0最不重要。因此在数据传输时，只要D7～D4按时到达，而对D3～D0则提供一定的等待时间，如能在规定时间内到达，则接收；否则丢掉。
　　(2)带宽限定的解决技术
　　如前面所述，Internet电话的语音传输机制是采用分组交换，当分组到达某个节点时，分组根据当前的路由的拥挤情况来决定是及时被转发还是被存储。因此，要实现Internet电话的语音实时传输，就必须满足一定的带宽要求，对于不同的语音压缩标准，所要求的带宽也不一样，例如：对于G.729压缩标准，需8kb/s的带宽，而如果采用G.723.1的标准进行语音压缩，只需5.3kb/s的带宽。尽管所需带宽相对于普通电话的带宽64kb/s来说要小得多，但Internet网络并不是总能满足。因为Internet网络的带宽本身就很窄，加上数据流量特别大，产生堵塞的情况经常发生。解决这个问题，一个较好的策略是制定一个协议，在连接Internet网络的路由中，通过对不同的数据类型设置不同的优先级来控制带宽的分配，可以将语音数据的优先级设为最高，使Internet网络的有限带宽最先满足语音传输的要求，从而实现Internet电话实时性。根据资料报道，CISCO公司生产的路由器就率先支持该功能。
　　(3)H.323协议栈的实现技术
　　实现Internet电话，必须考虑的1个重要因素是Internet电话的产品所遵循的标准问题，如果开发出来的Internet电话产品没有统一的标准，就无法实现互连。Internet电话的一个重要标准是H.323，该标准定义了通过Internet建立呼叫的过程和定义一系列的、用于Internet电话语音的压缩与解压缩的编码算法。H.323标准是由H.245、H.225、G723.1、G711、G729、G728、RTP、RTCP等协议组成。现今大多数厂商都支持该标准，如：Microsoft、Intel等。
　　当然，实现Internet电话网关，还需涉及其它一些技术，如DTMF的检测和生成、静音的检测和舒适躁声的生成等。
2　Internet电话网关的实现策略
　　根据目前市场上Internet电话产品情况分析，实现Internet电话有下列3种策略：专用的DSP处理卡方案、独立的箱级设备方案、PBX集成模块方案。这3种方案的选择，主要依赖于3个因素：即同时支持的呼叫数、所使用的压缩和解压标准以及功能需求。
2.1　专用的DSP资源卡方案
　　该方案是采用一个特定的DSP资源卡来实现Internet电话网关，实时语音压缩、解压缩和回声消除是一个加强的计算任务，可以用专用卡上的DSP芯片来完成，而不是由主机上的CPU来完成。这样就减少了延迟，可扩展的话路更多，在1台高档PC机(如：Pentium PRO微机)插上1块或多块这种特定的DSP资源卡，和网卡一起就可以构建1台Internet电话网关。通过该网关可将PBX和Internet或计算机局域网连接起来。
　　这类产品目前市场上也较多。例如：作为该领域的先驱者之一Quicknet Technologies公司生产出一种单口卡Internet phone TACK(tm)。该卡可以与已存在的Internet电话软件，如Netmeeting、Internet phone一起运行，可以在1台PC机同时安装有多达4个这样的DSP卡。Internet phone TACK(tm)利用其上的DSP，来实现H.323协议的压缩和解压缩以及自适应的回声消除等功能。
　　Micom是采用该方案的另一家公司，它已生产名为VIP(for Voice over IP networks)多口卡。该卡能将一个企业WAN与公司的PBX合二为一、该卡能在各种操作系统下工作、能和模拟和数字中继线相连，采用ITU-G.729标准进行语音压缩，能在IP协议网络上传输接近于电话线路质量的语音。
　　另外，DIALOGIC公司的DM3 Mediastream高密度语音卡是采用该方案的典型产品，DM3高密度语音卡是采用Motorola公司DSP56301(数据处理速度为100Mb/s，最多可带动18个)，具体结构如图3。 

2.2　建立PBX集成模块方案
　　随着Internet电话标准的出现，通过IP传递语音是交谈的一种重要工具，PBX生产商努力实现通过在原有PBX的基础上，加上附加模块来实现IP网络传递语音的方案。
　　该方案的基本思想是建立一个卡或模块，该模块一方面与PBX背板或交换开关部件(如SCSA总线)相连；另一方面，提供以太网络接口，通过该接口与计算机网络相连。来自PBX的呼叫经数字化、压缩，形成IP包后，由IP网络进行传输。该方案与在PBX上接一个外部网关相比，采用PBX集成化模块有如下优点：(1)构建超级系统，能将多个远程的PBX桥接到一个单一的超级系统中，用户能拨入用户名或扩展名就能完成一个办公室内部或外部的呼叫；(2)公共Internet拨号，可采用和WEB相同的URL方式进行拨号。
　　现在，不同的PBX生产商使用不同的方法来实现这一点，但不管怎样，都是在PBX中构建了一个附加模块。所有信号的发出与接收、包压缩与解压缩等处理都是在该模块内完成的。如果用户的所有交谈希望在普通POTS网上进行，用户只需拨9+普通电话号码；若使用Internet电话进行交谈，就可以用常规的电话拨9+IP地址就可以使用Internet。
　　该方案与电话系统的无缝集成，可以使多个系统与1个超级系统同时工作，因此比基于PC机的Internet电话网关的扩展性更好。
2.3　建立独立的箱级网关设备方案
该方案的基本思想是构造一个完全独立于电话系统的封闭设备，不需要专门的PC机。但和大多数计算设备一样，它内部也是由DSP或CPU、模拟中继线接口、IOBUS、以太网发收器、闪烁RAM和RAM缓冲区组成，如图4所示。该设备的数据处理过程是：首先对来自PSTN的语音进行数字化，然后进行压缩/解压缩，再用TCP/IP协议通过以太网络接口进行传输。


3　小结
　　有关Internet电话技术的研究成果和产品日新月异、层出不穷。前几年采用的PC机TO PC机的连接方式已渐渐地被网关方式所替代。因此，Internet电话网关是近2年来研究的主要方向。技术日趋成熟，相应的标准也日益完善，Internet电话网关产品更是五花八门，形形色色。但纵观各类产品的体系结构和实现的方法，并没有超出上述的3种实现策略。另外，Internet电话的下一个研究的热点将是Gatekeeper及其系统结构。 
作者单位：武汉华中理工大学计算机学院外存储国家实验室(430074)
参考文献
　1　叶敏.程控数字交换机与交换网.北京：北京邮电大学出版社
　2　张延平，林博文.计算机语音集成原理，技术和应用.北京：人民邮电出版社
　3　Cox R V，Kroon P.Low Bit-Rate Speech Coders for Multimedia Communication.IEEE Communication Magazine,1996;(12)
　4　Thom G A.H.323:The Multimedia Communcations Standard for Local Area Networks.IEEE Communications Magazine,1996;(12)
(收稿日期：1998-09-11)
