自动化学报
ACTA AUTOMATICA SINICA
1998年 第24卷 第1期  Vol.24  No.1 1998



自适应在线稳态优化方法及其
在丙烯腈装置上的应用
孙德敏　张志刚　薛美盛　吴　刚
摘　要　介绍了一种自适应优化方法，通过机理分析和模型结构辨识确定系统的模型结构，采用在线运行数据拟合过程动态模型参数，并依此计算目标函数相对于各操作参数的梯度，最终确定优化的方向.根据算法设计的计算机软件ANOPT在一个丙烯腈装置上得到实际应用.结果表明，本方法具有适应性好，抗干扰能力强，寻优速度快等特点，并且不需在线组分分析仪表，非常适用于实际工业过程.
关键词　系统辨识，稳态调优，流化床，丙烯腈.
AN ADAPTIVE ON-LINE STEADY STATE OPTIMIZATION METHOD
AND ITS APPLICATION TO ACRYLONITRILE APPARATUS
SUN DEMIN　ZHANG ZHIGANG　XUE MEISHENG　WU GANG
(Department of Automation of USTC, Hefei　230026)
Abstract　This paper proposes an adaptive optimization method. The model structure is selected through mechanism analysis and model structure identification. The dynamic model parameters are identified on-line using the process data, then the gradients of the object function for every operating variable are computed based on the model identified. Finally the optimal direction to move the working point is decided. The software ANOPT designed based on the algorithm has been applied to an industrial acrylonitrile apparatus and the result shows that this method has good adaptability, high anti-interference and quick optimization speed. As the method doesn′t need any on-line component analyzer, it is suitable for actual industrial process.
Key words　System identification, steady state optimization, fluid bed reactor, acrylonitrile.
1　引言
　　随着原材料涨价和市场竞争的加剧，工程师们需要一种能在不作设备投资条件下，通过操作条件优化而获取更多经济效益的方法.另一方面，由于原料变动、生产条件变化及市场的影响，生产装置常常没有工作在最优状态，利用寻优方法，随条件变化而不断调整操作条件以保持装置工作最优，将会起到提高产量，降低单耗和节约能源的作用，给生产者带来巨大的效益.因而操作调优愈来愈引起经营者和工程师们的兴趣，现有的稳态优化方法从模型的复杂性和应用策略可基本上分为两大类.不基于模型的直接法，以及基于模型的非直接法.
　　直接法利用爬山法等优化方法，不显式使用任何数学模型，通过改变工作点，计算和比较稳态的目标函数，确定下一步的寻优方向，由于需要很多次工作点修改尝试，而且每一次都要等待过渡过程结束并保持一段时间以观察目标函数，因此需要较长的时间来寻找最优工作点.当过渡时间较长或需要调整的变量较多时，这一问题更显严重.而且这种方法抗干扰能力较差，严重的干扰可能会导致调优失败.
　　基于稳态数学模型的调优方法，通过建立目标函数与操作条件以及外部环境的数学关系，在模型上计算最优工作点.当所得模型精确时，能接近真正的最优点.然而在实际应用中，由于对过程机理了解不够，系统过于复杂，参数随时间变化，或者由于不可测扰动的影响，使得建模十分困难且存在不同程度的不准确性，使得参数不能保证最优，甚至有很大偏离.
　　大多数化工过程都具有过渡过程长，噪声干扰大的特点，且随时间推移，由于催化剂老化，设备结垢堵塞等因素影响，最优工作点曲线随时间缓慢变化，给上述方法的使用带来较大的困难. R.ISERMANN 1978年提出一种在线稳态调优方法，考虑过程动态特性，用实际存在的操作波动，通过系统辨识方法建立在工作点附近的动态模型，进而得到目标函数对各操作因素的梯度，确定下一步调优方向.由于是利用过程的动态数据辨识模型计算梯度，而不需等待过程稳定，因而这种方法具有寻优速度快、抗干扰能力强，能跟踪最优点变化的特点.我们对其方法作了一些改进，在一个丙烯腈装置上取得了成功的应用.

2　问题的描述
　　一个基本的稳态优化问题可描述为
　　　　　　　　　　　　　　　　(1)
其中的关系是已知的，，分别为操作因素U， 系统输出向量y，目标函数Q的稳态值，优化的目标即是寻找一组符合约束的操作条件，使目标函数最大.这里假设等式约束可通过解方程消去，不等式约束可以通过在目标函数引入罚函数而不显式出现.
　　考虑到过程的动态特性且y与U的关系往往是非线性的，将其关系写为
yi=wi(U,t), 　i=1,…，l.　　　　　　　　　　　　　　　　(2)
非线性模型(2)，只有静态部分是我们关心的

利用最速下降法来寻找下一个工作点
　　　　　　　　　　　　　　(3)
δ为寻优步长.

其中

　　因为关系是已知的，所以问题的关键在于寻找模型yi=wi(U,t)，计算梯度.我们可以利用过程的动态运行数据以及系统辨识方法来在线建立模型，调优各部分与过程关系见图1.


图1　在线优化结构框图
3　模型辨识
　　为简化问题描述并不失一般性，在此只讨论MISO问题.令l=1,并假设过程是渐近平稳的.
　　y=w(U,t)的一种典型的非线性结构模型是Hammerstein模型，二阶离散形式的Hammerstein模型可写为
　　　　　　(4)
　　其中d为过程时延； e(k)为均值为0的不相关随机噪声； A(q-1), Bij(q-1)为m阶多项式； C(q-1)为nc阶多项式.
A(q-1)=1+a1q-1+…+amq-m=1+A′(q-1),
Bij(q-1)=bij1q-1+…+bijmq-m,
C(q-1)=1+c1q-1+…+cncq-nc .
从(4)式得y=w(U,t)静态部分及梯度关系
　　　　　　　　　　　(5)
Hammerstein模型对参数为线性，因而可以用增广最小二乘方法递推辩识模型参数，其算法为
　　　　　　　　　　(6)
其中λ∈(0,1］，为遗忘因子.


其中为e(k)的估计值.
4　在一个丙烯腈装置上的应用
　　基于以上算法，我们开发了一个在线优化软件ANOPT，并在某厂一个5万吨/年丙烯腈装置上取得成功的应用.该装置利用丙烯氨氧化法生产丙烯腈，原料丙烯、氨和空气进入反应器，在催化剂上发生反应，生成丙烯腈以及氢氰酸、丙烯醛、乙腈等副产物.反应气体经急冷塔绝热冷却，吸收塔吸收，然后经回收塔，脱氰塔，脱去乙腈、氢氰酸以及未反应气体等成分，进入成品塔，成品液态丙烯腈从塔侧线抽出，冷却后送至成品中间槽.
　　我们的目的是通过优化操作条件，提高丙烯腈收率，降低产品单耗.从工艺上分析，影响丙烯腈反应器收率因素主要有氨比，空比，反应器温度，反应器压力，线速，接触时间以及催化剂活性等因素.在这些因素中，催化剂活性是一个变化缓慢且不可控因素.接触时间与线速为反比关系，而线速是其它各因素的函数，所以我们选择氨比，空比，温度及反应器压力作为调节变量.因为装置没有在线分析仪器，只能通过系统尾部丙烯腈成品中间槽液位变化来计算产量.同时考虑到要建立的是一个动态模型，且一般条件下进料流量变化不大，所以选择丙烯腈单位时间产量作为系统输出和优化目标函数，通过提高丙烯腈产量间接达到提高收率的目的.丙烯进料对产量有较大影响，由生产要求决定，所以在模型中引入丙烯进料流量，但不将其作为可调节变量，取m=1,nc=1，根据以上分析，采用Hammerstein模型结构，得模型
　　　　　　　　　　(7)
其中y(k)为k时刻产量，u1,u2,u3,u4,u5分别为氨比，空比，温度，反应器压力以及丙烯进料流量.通过用参数变化很大的正交试验数据拟合，证明模型(7)足以表达产量和操作因素在较大范围内的关系.表面看来，似乎只要引入最小二乘辨识算法，就可构成自适应在线优化系统了，然而事情并非如此简单，由于产量是从尾部成品槽计算，中间环节甚多；液面测量精度有限，信号噪声十分强烈；而且在正常操作时，不允许施加测试信号，信噪比低；各操作因数相关性强，激励条件弱.模型(7)尽管已把多项式阶次降到最低，仍有待辨识的参数17个，在信号条件不够理想的情况下，过多待辨识参数只会给辨识带来困难，干扰信号很容易对辨识造成影响，一个较大的干扰可能会使计算的梯度反向，从而影响调优的进行.考虑到系统中的噪声，我们实际上用ARMA模型描述过程
　　　　　　　(8)
　　模型(8)并不能代表在整个工艺可操作范围内产量与各操作因素的关系，但比模型(7)更为实用.由于过程总是在工作点附近波动，寻优过程进行相对较慢，可以假设在工作点附近将过程近似为线性而不失精度，同时提高了抗干扰的能力.当工作点缓慢漂移时，带遗忘因子的辨识算法不断改变参数，模型跟踪过程变化而弥补了非线性.
　　引入(6)式辨识参数，并计算精度，得
　　　　　　　　　　　　　　　(9)
　　将(9)式代入(3)式，得
　　　　　　　　　　　　　　　(10)
其中(k)为k时刻工作点，具体计算时取过去一段时间的工作点平均值.*(k+1)为下一时刻投入的新工作点.
　　除了将模型降维降阶外，还在软件中从两个方面采取了保障优化和辨识的工作.首先是数据处理，包括对数据的归一化、滤波以及异常数据的初步修正.
　　由于各数据的变化范围与量级相差很大，在计算前要对操作参数的数据作归一化处理.

　　u′i为归一化后的值，uhi, uli为该变量变化范围，是通过对操作数据统计分析得到的，归一化处理可以提高计算精度，减少计算误差累积.
　　尽管可以用一阶低通滤波器对操作数据和产量数据作滤波以减轻噪声的影响，但由于操作影响会使丙烯腈在某些中间环节滞留或突然涌出，使得每个采样时刻产量有很大波动，影响辨识稳定，所以滤波后的产量数据还要进行检查，对波动很大的点预先作必要的修正.同时为保证调优过程的稳定，所计算梯度也要作滤波处理，具体作法是在每次调优时，使用过去一段时间梯度的均值来代替.
　　保障辨识的另一方面工作是在辨识时检查P矩阵正定性并剔除预测误差过大的点.
　　经过数据处理后的产量数据，仍然有一些会对辨识产生影响的较大波动未能除去，软件在每一步辨识时对预测误差作检查，预测误差过大的点，说明数据不太可靠，不用于辨识.
　　P矩阵在递推量小二乘辨识中起着重要的作用，理论上P矩阵是正定的，而且随着辨识逐渐收敛.但在数值计算中，由于误差累积，特别在信号相关性很强的条件下，P矩阵可能出现非正定的异常情况；而当矩阵元素非常小时，辨识会失去作用，无法跟踪参数变化.因此必须在线检测.首先在计算P矩阵时，保证了对称性；其次当P矩阵对角线上元素出现小于或等于零的情况时，对P矩阵赋初值，参数赋后备值，重新启动辨识；再次，当P矩阵对角线上出现小于一给定值元素时，将P赋单位阵.
　　通过采取以上措施，构成了一个较完备的监督级，保证了辨识的稳定和可靠.
　　利用该软件在某厂一个产量为5万吨/年的丙烯腈装置上进行了多次试验，都获得了满意的结果.图2是某次试验中丙烯腈产量变化曲线和模型拟合曲线，图3为调优过程中各操作变量的调节曲线.调优后的丙烯腈收率较调优前提高约2.1%，若软件长期运行，以提高收率1%，装置年产5万吨丙烯腈计，年经济效益达500万元.


图2　产量变化和模型拟合曲线


图3　优化过程中各操作参数调节曲线
　　软件中的主要计算参数有采样时间Ts，遗忘因子λ，优化步长δ，优化周期To.由于系统具有过程噪声强烈，时延比较大的特点.虽然小的Ts和λ会加快辨识速度，考虑到噪声影响，以及变量间相关性，为保持调优稳定，不能取得过小，实际上取Ts为20min，λ为0.995；优化步长δ的选择应考虑到模型的精度以及优化过程的要求，过大的δ可能会导致操作条件的反复变化甚至调优的失败，但由于主要操作条件皆非计算机控制，本身波动较大，以及仪表精度限制，也不能太小，否则起不到调优作用，通过具体计算与比较，取δ=0.5;优化周期To是每次调优之间的间隔时间，它要与其它参数作统一考虑，保证调优稳定，实验中取为8h.参数的选择实际上是快速性要求和噪声条件，信号激励情况以及仪表精度间的妥协.

5　结论
　　由于引入动态过程，并使用梯度寻优，这种在线寻优方法具有寻优快速，对干扰抵制能力强的特点.对于过渡时间长、噪声强烈、模型建立困难的系统，更具优越性.试验表明，它能以较快速度跟踪系统变化，具有良好的适应性能.与其它传统的调优方法相比，它的应用简单，不需要很多的工艺和机理知识，可用于较复杂的系统.而且不需在线分析仪表，可节省大笔投资，适合于实际工业过程应用.
　　在试验中，我们注意到调优引起的工作点变化，对过程参数的辨识起到了良好的促进作用，如果能实现主要操作变量的计算机控制，由调优软件作主动的细微调节，形成辨识与调优的良性循环，相信会取得更好的效果.

致谢　参加本项目工作的还有大庆石油化工总厂的杨彬彦、王吉溪、吴冠京、钟丙荣、梁德利、王禹、寇庭佳、阎田胜等同志，特表谢意.
1)　本文曾于1995年中国控制会议宣读.
作者简介：孙德敏　1939年9月出生，1964年从中国科学技术大学毕业后留校任教至今，现任中国科技大学自动化系主任，中国自动化学会理事，中国自动化学会控制理论专业委员会委员，多年从事工业控制过程先进控制和优化以及伺服系统综合研究.
　　　　　张志刚　1970年10月出生，1987年到1995年在中国科学技术大学自动化系学习，获工学硕士学位，毕业后留校工作至今.从事工业过程的先进控制和优化技术研究，主要方向在预测控制、系统辨识和过程优化技术，特别是其实际应用方面.
作者单位：中国科技大学自动化系　合肥　230026
参考文献
［1］　Bamberger W, Isermann R. Adaptive on-line steady-state optimization of slow dynamic process. Automatica, 14:223-230.
［2］　Hamei John W, Richenberg Gail B. On-line optimizing control of a packed-bed immiobilized-cell reactor. AIChE, 34(4):626-632.
［3］　Arkun Yamman, Stephanopoalos George Optimizing control of industrial chemical process: state of the artreview. JACC, 1980, WP5-A.
［4］　胡泽新，邵惠鹤.化工过程计算机优化控制.化工自动化及仪表.20(4)：1-4.
［5］　方崇智，萧德云.过程辨识.北京：清华大学出版社.
［6］　王建，蒋慰孙.一种动态系统稳态调优的抗干扰调优法，华东化工学院学报.16(1)：90-95.
收稿日期　1995-11-20
