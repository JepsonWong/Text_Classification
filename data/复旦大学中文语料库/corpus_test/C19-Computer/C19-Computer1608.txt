信息与控制
Information and Control
1999年　第28卷　第5期　Vol.28　No.5　1999



虚拟轴数控机床刀具运动状态的实时规划

周　凯

　　摘　要：提出了虚拟轴数控机床的递阶控制方法, 并着 重介绍了递阶控制的第一级――刀具运动状态实时规划所涉及的切削路径生成、刀具运动路 径计算和刀具运动姿态规划三个关键问题的求解过程, 为虚拟轴机床数控系统的研究开发奠 定了必要的理论与技术基础． 
　　关键词：虚拟轴机床，数控，路径，姿态，实时规划
　　中图分类号：TH16　　　　　　文献标识码：B
REAL-TIME PLANNING OF TOOL MOTION STATE
FOR VIRTUAL AXIS NC MACHINE TOOLS
ZHOU Kai
(Dept. of Precision Machinery, Tsinghua University Beijing 10008 4)
Abstract: The hierarchical control method of virtual axis N C machine tools is presented and the first level of the hierarchical control sys tem is emphatically discussed. This level deals with the task of real-time plan ning of tool motion state and involves three key problems, which are cutting pat h generation, tool path calculation and tool attitude planning. The solving pro cesses of the three problems are given. These results lay a foundation for the research and development of the numerical control system of virtual axis machin e tools.
Key words: virtual axis machine tool, numerical control, path, attitude, real-time planning

1　前言
　　1994年9月芝加哥IMTS'94国际展览会上, 美国 Giddings & Lewis 公司推出了费时6年研制成功的虚拟轴数控机床――VARIAX加工中心，受到举世瞩目．这种新型机床完全打破了传统机床结构的概念，抛弃了固定导轨刀具导向方式，转而采用由六可变长度杆驱动主轴作多自由度运动的并联闭链结构，因而不仅加工的自由度增加，可以加工更为复杂的零件，而且更为重要的是，这种新型机床的刚度比传统机床提高五倍以上［1］，使加工精度和加工质量大为提高，此外在加工速度上也比常规机床提高数倍以上，从而满足了正在发展的高速加工的需要．
鉴于虚拟轴机床具有上述众多优点，并对推动机床、制造以及相关学科和产业的发展具有重要意义，它的研究与开发得到了世界各国的广泛重视，已成为国际上机床研究领域的一个热点［2,3］．
　　通过对虚拟轴机床的分析, 可以看到, 这种机床的最大特点是机械结构简单而控制复杂 ．因此，要结合国情研究开发具有中国特色的虚拟轴数控机床产品，必须首先解决其控制问题，研究开发出高性能的虚拟轴机床数控系统．
　　考虑到虚拟轴机床控制的复杂性, 本文提出一种解决其控制问题的递阶控制方法，并着重介绍了递阶控制的第一级――刀具运动状态实时规划所涉及的切削路径实时生成、刀具运动路径计算和刀具运动姿态规划三个关键问题的求解过程, 为虚拟轴机床数控系统的研究开发奠定了必要的理论与技术基础．
2　虚拟轴机床控制的基本原理
　　虚拟轴机床的典型结构为六杆平台结构，即由六根可变长度杆驱动一活动平台（其上装有主轴单元），六驱动杆的另一端固定于基础框架（静平台）上．调节六驱动杆的长度，可使主轴和刀具作六自由度运动．
　　那么, 应如何控制这六根驱动杆的长度, 才能使刀具的运动状态 (轨迹和姿态) 满足加工要求? 这便是虚拟轴机床控制的核心问题．解决这一问题的基本思路是分两步走, 第一步先根据输入信息对刀具的运动状态进行实时规划, 即求解出各虚拟轴的希望运动量,第二步再将虚拟轴的希望运动量转换为六驱动杆的运动指令值并据此对各杆的长度进行实时控制．通过这一由规划与控制实现的虚到实的变换，以及由机床结构隐含实现的实到虚的逆变换, 即可得到所要求的刀具运动姿态和轨迹．根据上述思路，本文提出一种两级递阶控制方案，其基本原理可通过图1进行说明．

图1 虚拟轴机床递阶控制原理框图

　　由图可见，递阶控制的第一级为刀具运动状态实时规划,其主要任务是根据输入给控制 系统的被加工零件的几何工艺信息，对刀具的希望运动状态进行实时规划，产生虚拟轴 X、 Y、Z、A、B、C的运动指令．完成这一任务包括三个步骤: 第一步由切削路径生成模块根据 输入信息实时生成被加工表面上的切削路径，即刀具与加工表面接触点的移动路径．第二步 由刀具运动路径计算模块对线性虚拟轴X、Y、Z的运动量进行计算,主要内容是计算切削路 径上各离散点处的法线矢量，并根据刀具尺寸在各离散点处沿法线方向求得所希望的刀具球 心坐标位置．第三步由刀具姿态求解模块对转动虚拟轴A、B、C的运动进行规划,主要内容是 根据所要求的刀具轴线与切削点法线间的关系以及允许的主轴姿态空间求解出最优或可行的 刀具运动姿态．
　　递阶控制的第二级为刀具运动状态实时控制,主要任务是按进给速度要求将刀具希望状态转换为各采样周期驱动杆的给定长度并据此对实轴进行联动控制,以使刀具的实际运动状态与规划的运动状态相符合．第二级的控制问题在文[4]中作过详细介绍．本文着重介绍递阶控制的第一级所涉及的切削路径实时生成、刀具运动路径计算和刀具运动姿态规划三个关键问题的求解过程．
3　切削路径实时生成
　　设零件被加工表面可用双三次B样条曲面表示，其表达式为
X(u,v)＝UMPxMT VT　　　　　　　　　　　　　　　　
Y(u,v)＝UMPyMT VT　　　　　　　　　　　　　　　　　　　　
Z(u,v)＝UMPzMT VT　　　　　　　　　　　　　　　　　　(1)
式中X(u,v)、Y(u,v)、Z(u,v)―B样条曲面上任一点的坐标值
　　　u、v―参变量， U＝[u3u2u1]，
V＝[v3v2v1]
　　　M―常数矩阵
　　　Px、Py、Pz―几何系数矩阵，包含了B样条曲面的全部几何信息．
　　切削路径实时生成解决如何根据B样条曲面表达式和加工工艺信息, 实时计算出刀具切削点移动路径上各离散点的坐标值．为此，首先用相互平行的切削平面切割零件加工表面得希望切削路径．显然，第k条希望切削路径为第k个切削平面上的一条曲线, 其u-v域表达式为
AkX(u,v)+BkY(u,v) +CkZ(u,v)+Dk＝0　　　　　　　　　　　　(2)
　　实际控制时需用直线段L1,…,Li ,Li+1,…来逼近希望切削路径, 逐步得到 其上各离散点P1,…, Pi, Pi+1,…的坐标值．为此需建立由已知点Pi求Pi +1的算法．下面从求弦长Li+1着手进行讨论．
根据弦与弧间的误差关系有
(Li+1／2)2＝ρ2－(ρ－δ)2　　　　　　　　　　　　　　　(3)
式中δ―实际切削路径(弦Li+1)与希望切削路径间的允许误差
　　ρ―Pi点处切削路径的曲率半径
　　由此求得Pi点与Pi+1点间的弦长Li+1, 其表达式为
　　　　　　　　　　　　　　　(4)
下一步的任务是求出参变量u(或v)对弦长L的变化率．为此先让参变量u取一增量Δu得
i+1=ui+Δu　　　　　　　　　　　　　　　　(5)
式中i+1―Pi+1点处参变量u的估计值
　　ui―Pi点处参变量u的实际取值
　　Δu―切削点从Pi-1移至Pi时,u的增量
然后将i+1代入切削路径的u-v域表达式(2)解出vi+1的估计值i+1．将i+1、i+1代入式(1)得到Pi+1点的坐 标估计值． 按下式可计算出与Δu 相对应的弦长增量
　　　　　　　(6)
　　由此得到参变量u对弦长L的平均变化率
k=Δu/ΔL　　　　　　　　　　　　　　　　(7)
　　根据上面已求得的弦长Li+1和参变量u对弦长L的变化率,便可计算出Pi+1 点处u的实际取值
ui+1＝ui+k.Li+1　　　　　　　　　　　　　　　　　(8)
再将ui+1代入式(2)可解出v在Pi+1处的实际取值vi+1．
　　最后，将ui+1和vi+1代入B样条曲面表达式(1), 即可得到Pi+1点的坐标值．
4　刀具运动路径计算
　　刀具运动路径是指刀具上某一点 (如球头中心) 的移动路径．刀具运动路径的求取需经两步 完成，第一步先根据加工表面几何信息, 求取切削点单位法线矢量N(u,v), 第二步再根据刀 具信息和已求得的法矢信息求取与切削点序列相对应的刀具运动路径的离散点序列，即离散 化的刀具路径．为求出单位法矢需先按下式求出切削点法线矢量
NM(u,v)＝NMx(u,v)i+NMy(u,v)j+NMz(u,v)k　　　　　　　　(9)
式中i、j、k―X、Y、Z 轴方向的单位矢量
　　NMx(u,v), NMy(u,v), NMz(u,v)―切削点法矢NM(u,v)在X、Y、Z 坐标轴上的分量



　　然后根据法矢分量求得法矢的长度
　　　　　　　　　(10)
　　进一步即可求得单位法矢
N(u,v)=Nx(u,v)i+Ny(u,v)j+Nz(u,v)k　　　　　　　　　　　(11)
式中Nx(u,v), Ny(u,v), Nz(u,v)――单位法矢N(u,v)在X、Y、Z 坐标轴方向的分量
Nx(u,v)=NMx(u,v)／|NM(u,v)|　　　　　　　　　　　　　　
Ny(u,v)=NMy(u,v)／|NM(u,v)|　　　　　　　　　　　　　　
Nz(u,v)=NMz(u,v)／|NM(u,v)|　　　　　　　　　　　　　　
　　使用球头铣刀时，在求得单位法矢后，沿法矢方向偏移刀具半径r, 即可得到以刀具球心坐标表示的刀具路径
Xc(u,v)＝X(u,v)+r.Nx(u,v)　　　　　　　　　　　　　　　
Yc(u,v)＝Y(u,v)+r.Ny(u,v)　　　　　　　　　　　　　(12)
Zc(u,v)＝Z(u,v)+r.Nz(u,v)　　　　　　　　　　　　　　　
　　如果使用的是非球头铣刀，则需根据刀具的具体几何形状来计算刀具路径．
　　最后，将Pi+1点处的u、v值ui+1、vi+1代入式(12), 即可得到刀具 路径上与Pi+1点相对应点的坐标值．
5　刀具运动姿态规划
　　为描述刀具运动姿态，建立一原点位于刀具轴线上某一点 (如刀具球心) 的刀具坐标系，其 Xt、Yt、Zt轴分别与机床坐标系的X、Y、Z 轴平行．这样，刀具运动姿态可用各切削点处刀具轴线绕Xt轴和Yt轴的旋转角度来表示．在多坐标加工时，为了保证切削速度恒定，刀具轴线需位于以切削点法线为中心轴、刀具球心为顶点且半顶角为的圆锥面上．对于虚拟轴机床，其主轴的允许姿态空间为一位于Zt轴附近且以刀具球心为顶点的锥体内, 这一允许空间一般是随主轴位置变化的．显然，刀具轴线所在圆锥面与主轴允许姿态空间的交即为可行的刀具姿态域．
　　从可行刀具姿态域中确定最佳刀具姿态的过程比较繁琐，将另拟专文介绍．下面给出一 种求可行刀具姿态的方法．
　　首先, 过刀心点作一平面使其包含Zt轴和切削点法线, 如图2所示．然后在该平面上过刀心点作一直线Lt，并使该直线与切削点法线间的夹角等于刀具轴线所在圆锥的半顶角，此直线即为一可行的刀具轴线，其方程为
　　　　　　　　　　　　　　(13)
式中Xc、Yc、Zc―刀具球心坐标
　　l、m、n――刀具轴线的方向数
　

图2　可行刀具姿态
　　刀具轴线Lt的方向数l、m、n 即定量地描述了刀具的姿态, 其具体值可通过图2求出．
　　为便于控制将刀具姿态以转角形式表示．刀具轴线绕Xt轴的转角为
　　　　　　　　　　(14)
刀具轴线绕Yt轴的转角为
　　　　　　　　　　　　　(15)
　　到此,刀具运动状态规划任务即已完成．
6　仿真实验结果
　　为了验证所提出的方法的正确性和可行性, 进行了多次仿真实验．实验是在一个Pentium 计算机系统上进行的．该机采用PII(350MHz)CPU．实时规划算法以C语言＋32位汇编语言混合编程方式实现．
　　图3所示为仿真实验之一所用曲面的三维图形．图中，曲线的相交点为自由曲面的型值点，供132个．图4所示为经刀具状态实时规划所产生的刀具运动路径和刀具运动姿态 (以刀具轴线矢量表示)．为了显示清楚，图中的刀具路径与姿态是隔行显示出的．图示结果和数据抽样检查结果表明，本文所提出的方法是正确的．
　　　　
　　　　图3 自由曲面图形 　　　　　　　　　　　　　　　　图4 刀具路径与姿态
　　经过测试，完成一次实时规划 (计算曲面上切削路径的一个逼近直线段和相应的刀具路径离散点坐标值及刀具姿态坐标值) 所用时间约为 2毫秒．这样，在一个采样周期 T(5毫秒) 内还剩余3毫秒, 即还有60％的机时可用来完成数控系统的其它功能，如图形显示、人机交互、信息处理、轨迹控制等．这说明，这种实时规划方法完全可以在基于PC机的CN C系统中实现．
7　结论
　　虚拟轴机床的最大特点是机械结构简单而控制复杂．因此，要结合国情研究开发具有中国特 色的虚拟轴数控机床产品，必须首先解决其控制问题，研究开发出高性能的虚拟轴机床数控系统．
　　针对虚拟轴机床控制的复杂性，本文提出了解决其控制问题的递阶控制方法，这一方法 包括实时规划和实时控制两大步骤．文中重点介绍了递阶控制的第一级所涉及的切削路径实 时生成、刀具运动路径计算和刀具运动姿态规划等三个关键问题的求解过程．并给出了仿真 实验结果．
　　理论分析和仿真实验证明，本文所提出的原理和方法是可行的，所得结果为解决虚拟轴机床的控制问题找到了一条有效的途径，为开发虚拟轴机床数控系统奠定了必要的理论与技术基础．
注释：基金项目：国家863高技术计划资助项目
作者简介：周　凯，男，1954年9月生，清华大学精密仪器与机械学系副教授，工学博士．主要从事数控技术、机电控制工程、制造科学与制造系统等方面的研究工作，发表有关论文 60余篇．
作者单位：清华大学精仪系机器人室　北京　100084
参考文献
1　言川宣编译. 机床结构的重大创新――VARIAX 机床问世. 世界制造技术与 装备市场, 1995,(1):16～17
2　汪百川. 虚拟轴机床数控技术的研究. 硕士学位论文. 北京：清华大学, 1996
3　中国机床工具工业协会赴EMO97工作组. 六条腿机床取得重大进展. 世界制造技术与装备市场, 1998,(1): 17～22
4　周 凯. 虚拟轴数控机床的虚实映射联动控制. 中国机械工程，1998,9(3) : 16～18
5　Chen Y D, Ni J, Wu S M. Real-time CNC Tool Path Generation for Machining IGES Surfaces. Journal of Engineering for Industry, 1993, 115(11): 480～486
收稿日期：1999-01-04
