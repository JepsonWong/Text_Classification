微型机与应用
MICROCOMPUTER & ITS APPLICATIONS
1999年 第18卷 第4期 Vol.18 No.4 1999



语音芯片W51300与单片机的控制技术
项新建
　　摘　要：W51300是台湾Winband公司生产的语音处理芯片。文中给出了W51300的引脚功能，阐述了它的按键控制与CPU控制2种模式，介绍了它与单片机AT89C2051构成的交通广播报站系统的设计。
　　关键词：W51300语音处理芯片　语音处理　AT89C2051单片机　语音控制
　　Winband公司推出的外置FlashRAM的语音处理芯片W51300，除了支持按键控制直接话筒和喇叭的随录随放功能和快速搜索放音模式外，还具有完善的CPU微处理器控制模式，用单片机能控制它的所有功能，通过软件设计还能实现按键控制所达不到的其它功能。W51300直接外挂512KB～16MB的FlashRAM。其录放时间最长可达50多分钟。长时间断电语音不断失，最大可分63段。语质，录放时间可按要求进行调节，语音清晰度好。工作电压2.5～5.5V，静态电流0.1μA，工作电流15mA，芯片按工业级产品性能进行设计。
1　引脚功能
　　W51300为32脚双列直插式标准封装DIP芯片。各引脚端功能如表1。
表1　W51300引脚功能
引脚名称功　能引脚名称功　能
1BWD退段端17VCCA模拟信号电源正端
2STOP停止端18OSC取样频率电阻输入端
3EOP录放音结束信号19MICREF话筒输入参考端
4CLK外置存储器串口时钟20MIC话筒输入
5ADDR外置存储器地址端21AGC自动增益控制端
6DATA外置存储器数据端[〗22VCCD数字信号电源正端　
7CTRL外置存储器控制端[〗23CPUCPU微处理控制端　
8MODE外置存储器模式控制[〗24SMODE分段控制端　
9BUSY忙状态标志位25NOP空
10LED录音状态输出端26NOP空
11VSSD数字信号电源地27RESET复位端
12VSSA模拟信号电源地28L-REC录音端
13SPK-扬声器放音端29L-PLAY电平放音控制端
14SPK+扬声器放音端30E-PLAY脉冲放音控制端
15VCCA模拟信号电源正端31ERASE语音清除键
16NOP空32FWD进位键

2　按键工作模式及典型应用电路
　　W51300按键工作模式下的典型应用电路如图1所示。在录音状态下，语音信号经话筒检拾放大，再由W51300内部的A/D转换器转换为数字信号，存储在外部FlashRAM中间。在放音状态下，W51300从存储器中取出信号，经D/A和噪声处理及放大后，驱动外接喇叭发出原录的语音。图1中，R1、C1是话筒自动增益控制元件，R2、R3为外接驻极体话筒的偏压电阻。Rosc为系统频率振荡电阻，它决定语音处理的取样频率，也影响音质的好坏，典型取值为Rosc=1.5MΩ，此时系统的采样频率为10kHz。它和外接存储器的容量一起决定录放音时间。配套的外接存储器有1MB的F5010和2MB的F50202种型号。



图1　典型应用电路
　　录音工作时，按住录音键即为录音状态，松开后即停止录音并自动形成一段。放音工作有2种方式，按住电平放音键L时即放音，松开即停止，若一直按住则依次放音所有段，并不间断地循环放音。按一下脉冲放音键E，即将一段放音直至结束。该键也支持快速搜索模式。复位键起复位作用。按一下再放音即到第一段的段首开始。退段键起往后跳作用，每按几下就往后跳几段。若按键时间持续超过1s，即自动退到最后一段。进段键起往前跳作用，每按几下就往前跳几段。若按键持续时间超过1s即自动进到最前一段。停止键起停止放音作用。清除键起消除语音内容作用。点按一下清除当前段的语音内容，按住键时间超过2s即清除全部语音内容。SMODE为分段控制端，高电平不分段，低电平分段。CPU为工作模式控制端，高电平为微处理器工作模式，低电平为按键控制模式，LED为录音显示端。录音时LED输出高电平，溢出时LED输出3Hz闪烁信号。BUSY为放音显示端。放音时高电平，不放音时低电平。
3　微处理器工作模式及应用实例
　　W51300芯片在CPU工作模式下提供了良好的微处理器接口，它只用5个引脚与CPU相连。如图2所示。其中RESET、ERASE、STOP为输入信号，FWD、BWD为输出信号。


图2　W51300的CPU工作模式
　　W51300提供了可由CPU控制的10种操作方式。操作方式与W51300所计的脉冲个数有关。脉冲计数过程以CPU1脚信号的上开沿开始到1脚信号的下降沿为止，所计的为2脚在这段时间里的脉冲个数。计数过程波形如图3所示。脉冲个数与各种操作方式对应关系如表2。


图3　工作脉冲计数过程
表2　工作脉冲个数与操作方式对应关系
1个脉冲录音
2个脉冲放音
3个脉冲语音内容清除
4个脉冲停止录放音
5个脉冲存储器复位
6个脉冲系统复位
7个脉冲读当前地址指针
8个脉冲读段码
9个脉冲存4B数据到存储器
10个脉冲从存储器读4B数据

　　W51300在收到CPU的1个指令后，在3脚和4脚上将回送1个相应的响应信号，如图4所示。通过计数3脚高电平期间4脚的脉冲个数，可知道W51300的工作状态。二者之间对应关系如表3。


图4　状态脉冲计数过程
表3　状态脉冲个数与状态对应关系
1个脉冲指令被接收
2个脉冲工作电压低
3个脉冲存储器溢出
4个脉冲段码超出
5个脉冲当前地址指针错误
6个脉冲工作横式未知
7个脉冲未知错误

　　根据上述介绍的CPU工作模式，我们设计了一个用AT89C2051控制的交通报站系统，其硬件框图如图5所示。


图5　交通报站系统硬件框图
　　按键电路设有站号键、放音键和停止键。LED显示电路显示各站站名汉语拼音、编号以及系统的工作情况。W51300完成录放音工作。AT89C2051实现各部分的连接与控制。
　　系统软件设计如图6所示。通过对按键电路和显示电路的管理，实现到站到点、转弯过道、过桥等报放音功能。


图6　交通报站系统软件流程图
　　随着数码语音技术的发展，数码语音芯片具有的体积小、无介质损耗、寿命长、调用快捷、控制方便、抗振强度高、适应复杂环境等特点将更为突出。在各种工业设备、家用电器、广告宣传、交通工具、旅游设施、通信系统等领域中将得到广泛的应用。
作者单位：杭州应用工程技术学院电机系（310012）
参考文献
　1　何立民.单片机应用技术选编.北京：北京航空航天出版社，1997
　2　周湘峻.外置快闪存储器的语音处理器W5701.电子世界，1997；（12）
收稿日期：1998-10-26
