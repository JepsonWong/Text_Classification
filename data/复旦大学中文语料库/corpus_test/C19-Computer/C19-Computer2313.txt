计算机研究与发展
JOURNAL OF COMPUTER RESEARCH AND DEVELOPMENT
1999　Vol.36　No.6　P.653-663



数字电视接收机顶盒的发展及其对计算技术的影响
陈熙霖　高文
摘　要：机顶盒(STB)是近年来迅速发展的新兴技术，很多国家都将其作为未来计算机和电子工业发展的重点.文中讨论了用于数字电视接收的机顶盒的主要技术、涉及的标准、机顶盒采用的操作系统和软件结构，并分析了几种典型的机顶盒结构.同时还讨论了STB发展对计算技术的影响以及未来机顶盒技术的发展趋势，指出集电视节目接收、DVD、Internet服务、游戏机为一体的机顶盒将是未来机顶盒的发展方向.
关键词：机顶盒，DVB，DAVIC，数字电视，DTV
分类号：TP3；TN91；TN3
DEVELOPMENT OF SET-TOP BOX FOR DIGITAL TELEVISION
AND ITS EFFECTS ON COMPUTING TECHNOLOGY
CHEN Xi-Lin，GAO Wen
(Department of Computer Science, Harbin Institute of Technology, Harbin 150001)
GAO Wen
(Institute of Computing Technology， Chinese Academy of Sciences, Beijing 100080)
Abstract：Set-top box (STB) is an emergent technology in recent years, and a lot of countries take it as the new growing point of their computers and electronic industry. Here discussed are the major technologies for STB, the standard used in STB, operating system, and the structure of the software. In addition, some typical STB's structures are also given. Also pointed out are the effects on computing technology and chip's trends along with the development of the digital television receiver. It is thought that the STB which gets all the functions of TV receiver, DVD, Internet service, and game player together will be popular in the future.
Key words：set-top box, DVB, DAVIC, digital TV, DTV▲
1　引　　言
　　机顶盒(set top box)是广播媒介实现数字化后用于接收端的重要设备.机顶盒按其功能的不同可以分为两大类，一类是以看电视为目的的机顶盒，如各种用于有线电视收费的机顶盒、用于接收数字电视节目的机顶盒等；另一类是以电视为工具，借助电视获取其他信息的机顶盒，如Web TV等.实际上，随着这两种机顶盒的发展，在功能上的界限将日益模糊.早期的机顶盒是指放在电视机上可以由观众通过遥控器或按键控制的电视节目接受与转换装置.这种装置的主要目的是对某些收费节目的收看进行控制.近年来随着广播电视节目的数字化以及Internet的迅速普及，机顶盒的功能也变得越来越强，机顶盒的作用从单一的解密收费发展成为集解压缩、Inter
net浏览、解密收费、交互控制为一体的数字化装置.由于这一领域可能成为未来10年甚至更长时间计算机与消费类电子产品的主流，因此包括IBM，Intel，Philips，ST，Sony，Microsoft等在内的很多大公司都开始进入这一领域，一些国际或地区性的组织也纷纷制定相应的标准和建议［1～6］.
　　本文讨论用于数字电视接收机顶盒的关键技术和国际上这一领域的最新进展.在第2节中介绍了目前主要的数字电视广播标准；第3节中讨论了相应的解调和信道解码技术；对信源解码即解压缩技术在实现上的进展在第4节中有所讨论；随后在第5节中分析了目前常用的计费和条件接收方式；对机顶盒而言，软件与芯片一样重要，数字电视接收机顶盒的软件系统都是建立在某一操作系统基础上的，所以在第6节中给出并分析了一些机顶盒中采用的操作系统和软件结构；目前世界上一些主要的半导体制造商都纷纷介入这一领域，推出各自的机顶盒芯片和整机，在第7节中介绍了目前几种典型的机顶盒结构；然后分析了这一趋势对计算技术的影响；最后对机顶盒技术的发展方向进行了分析.我们认为这一领域将成为计算机和消费类电子的结合点，是计算机软硬件、通信和半导体器件技术发展的高度结合.
2　数字广播的标准
　　在数字通信系统中协议是核心，这里的协议就是数字广播的标准.从1990年GI(General Instrument Co.)公布DIGICIPHER开始，先后产生了多个不同的标准，其中最有影响有DVB，DSS以及大联盟DTV等，其中DVB中针对卫星广播、有线电视和地面广播等的不同形式分为DVB-S,DVB
-C和DVB-T.此外，DAVIC建议的规范对整个数字音视频系统的发展起到了重要的参考作用.按照国际电联的规范，数字电视系统由3部分即信源编码、业务复用与信道传输和发送部分构成.
　　在这几种标准中，信源编码中的视频都是采用MPEG-2［7］，音频或者采用MUSICAM［8］或者采用AC-3［9］.业务复用采用的都是MPEG-2系统层规范或其扩展形式［10］，这几种标准的主要差别在于对信道和发送部分的设计上，它也反映了这些国家的不同认识.这几种标准的对比如表1.图1是这几种标准的信源编码系统的结构，图2到图5是信道编码和传输系统的结构.
表1　几种数字广播标准比较

　DVBDSSDTV
视频编码MPEG-2MPEG-2MPEG-2
音频编码MUSICAMMUSICAMAC-3
系统复用MPEG-2MPEG-2MPEG-2
信道编码RS+卷积码RS+卷积码RS+格状编码
调制方式QPSK/QAM/OFDMQPSKVSB


图1　数字视频广播中的信源编码


图2　DVB-S中规定的信道编码与传输系统


图3　DVB-C中规定的信道编码与传输系统


图4　DVB-T中规定的信道编码与传输系统


图5　DTV中规定的信道编码与传输系统
　　除了上述使用范围较为广泛的标准之外，还有一些其他变通的标准，如JSAT，KSAT等，它们在PSI信息方面进行了相应的改变.我国目前已采用DVB-S作为卫星数字电视节目的标准，在有线电视方面，目前考虑采用与DVB-C类似的标准.
3　解调与信道解码
　　在数字信号的传输中，调制方式的选择是极其重要的，它主要取决于以下几方面的因素：
　　(1) 系统复杂度
　　(2) 频谱利用率
　　(3) 载噪比门限
　　目前在下行信道上普遍采用的调制方式包括QPSK(四相相移键控)、QAM(正交幅度调制)、VSB(残留边带调制)和OFDM(正交频分复用调制)等几种方法.根据传输介质的差别，目前在卫星传输的系统中DVB-S和DSS都采用了QPSK调制.从信道利用率、网络均衡以及不需训练序列，可以盲均衡等方面考虑，在有线电视系统中，DVB-C采用了QAM调制方式，并根据有线信道特性的不同，可以分别采用16/32/64/128/256-QAM等不同方式.而在DTV中，采用的是VSB调制.对不同调制方式，信道载噪比与误码率的关系有所差别，如图6所示.实际上通过采用适当的信道编码方式可以降低对载噪比的要求大约5dB.在地面广播中，欧洲DVB利用在DAB中取得的成功经验，依旧采用OFDM方式，美国DTV则还采用VSB方式.采用VSB的优点是设备简单、成本低，但需要训练序列，因此在发射端需要插入导频信号.


图6　不同调制方式下的误码率与信道载噪比的关系
　　为了提高传输系统的可靠性，在这几种传输系统中都采用了一定的信道编码措施.除了RS编码以外，在信道条件较差的环境下，如卫星或地面传输系统中还增加了卷积编码(DVB-S，DVB-T)或格状编码(DTV).RS编码可以有效地处理少量的突发性错误，但是对于纠正多个连续错就难以胜任了.因此在RS编码后一般都加上卷积交织，这样保证在信源编码和解码端连续的位在传送时不连续，从而提高抗干扰能力.
　　在数字广播领域中，除了下行之外，上行已成为日益重要的部分.在无线传输系统(如卫星和地面微波)中，普遍采用电话作为回传方式，而且在回传中多数采用存储转发的方式，即将需要发送的信息存在机顶盒内，在前端访问时再进行实际的传送.在有线传输系统中(主要是HFC)，由于本身具有宽带传输的优势，因此人们越来越重视基于Cable的回传技术.但是这种方式存在两方面的困难，首先是技术上的，由于上行信道存在很大的噪声，消除这些干扰在技术上具有相当的复杂性，因此在一定程度上影响了这一技术的普及；其次是非技术性的因素，由于标准统一上的问题，实际上目前至少存在着3个不同的标准，即MCNS的DOCSIS，IEEE的802.14和DAVIC的标准，这些标准互不兼容，因而也影响了高速回传系统的使用.
4　信源解码
　　在数字视频广播中不论是DVB，DSS还是DTV都无一例外地采用了MPEG-2作为视频信源编码手段.在SDTV这个层次上都采用MPEG-2中MP@ML，而在HDTV中则采用的是MP@HL.由于MPEG-2视频解码需要大量的计算资源，因此目前大多数的解决方法是采用专用的解码芯片，而在这些芯片的内部都大量采用了并行处理技术，其中主要是流水线方式.图7是LSI的L64020结构，它与大多数的MPEG-2解码芯片不同的是在L64020中既可以进行MUSICAM的解码也可以进行AC-3的解码.图8是ST的STi3520A视频解码部分的结构.


图7　LSI L64020解码器结构


图8　STi 3520A MPEG-2解码器视频解码部分结构
　　对解码过程的控制主要有两类不同的方式，一类是通过微程序控制解码过程，这类解码器在工作之前先将微程序装入解码器，解码器在工作过程中直接接受PES/ES流，完全独立地完成视频流的分析、解码过程，这类解码器的典型代表如IBM的CD20/21，这种工作方式的优点是对控制器的要求较低，一旦启动整个系统工作之后只需要在视频缓冲不满的时候填充数据即可；另一类视频解码器的工作是通过解码器与控制器共同完成的，这类解码器的典型代表如STi 3520A.下面我们结合图8的结构分析解码过程中的数据流向关系.　　
　　在解码过程中，压缩数据通过控制总线进入压缩数据队列，之后进入位流缓冲(bit buffer)，只要压缩数据队列尚未达到填满的阈值，就可以不断送入码流数据.在位流缓冲中的数据一方面被拷贝到起始码检测器(start code detector)中用于检测码流中各种头尾信息（如序列头、序列尾、图组头、图像头等），如果找到这些头、尾信息则通过中断通知控制器，控制器根据对头信息的分析相应设置解码器的工作状态，如设置显示格式、启动新的一帧图像解码等.另一方面，位流缓冲中的数据不断移出进入变长编码解码器，进行变长解码后的数据再进行运动补偿、反Z扫描、逆量化、IDCT等解码过程，恢复后的图像送入DRAM中，之后每产生一个DSYNC信号将导致相应图像的显示，同时在解码过程中每个DSYNC信号又是启动起始码检测器的启动信号.这类解码器的工作过程要求控制器不断干预，因此软件设计上，要求对视频解码过程有充分的理解.
　　表2给出了目前部分主流的MPEG-2 MP@ML的解码芯片.
表2　目前一些主流的MPEG-2 MP@ML解码芯片

公司型号
IBMCD1M, CD1V,CD20, CD21, STB1000
STSTi3520, STi 55xx
C-CubeCL9100
LSIL 64005, L 64020
PhilipsSAA 7201
TIAV-7000


　　数字电视接收机中的音频编码方式和DVD非常相似，美国选择了AC-3作为DTV中音频信源编码的标准，欧洲则采用MUSICAM作为DVB中音频编码的标准.与视频解码方式不同，在音频解码上目前的解码芯片多采用嵌入的DSP内核来实现的，如IBM的CD-20/21、ST的STi 3520A等.采用这种方式的解码器多数是将DSP的程序固化在解码器内，但有些解码器如IBM的CD-20/21的微程序则是动态装入的，这样的优点是可以灵活处理算法上的一些变化，适应不同的应用需求.
　　在MPEG-2音视频解码方面，除了采用专用处理芯片的做法之外，一些半导体公司也在积极考虑采用通用处理器的方法，如TI利用其在DSP方面的优势，采用DSP芯片AV-7000处理MPEG-2解码，而Intel正在采用Pentium II和StrongARM进行MPEG-2软件解码的机顶盒设计，1999年初推出第一代基于Pentium II的数字电视机接收机顶盒.由于直接进行MPEG-2软件解码的处理器大约需要200MFLOPS以上的计算能力，因此目前已有相当的通用CPU具有直接处理MPEG-2 MP@ML音视频解码的能力.
5　计费与加密系统
　　在电视广播中越来越多地采用了加密处理技术，这是由于数字编码技术更容易实现加密和解密.图9是DVB中收费管理的概念性结构，在这种管理模式中，网络管理中心通过向接收端授权来控制其接收.在DVB中通过采用公共的加扰算法和各自不同的加密算法，以同时满足对设备的互换性和对接收保密性的要求.为了保证加密的可靠性，用于解扰的控制字是经常改变的，通常在10秒以内至少要发生一次变化.这种加密机制可以实现对用户的按月收费管理和按节目收费管理.


图9　DVB中条件接收的概念性结构
　　在DVB系统中可以在压缩后或复用层上进行加扰(scramble)，但不能同时在这两个层次上进行操作.加扰后的解扰控制字通过加密算法加密后利用ECM进行传送.
6　机顶盒的操作系统及软件结构
　　机顶盒是到目前为止除计算机以外的电子类产品中软件含量最大的产品之一，实际上它是一个专用化的带有通信接口的计算机系统，因此和其他所有计算机系统一样，操作系统是必不可少的.同时，由于面向家用的产品在价格、产量上与普通计算机系统的差别又决定了这里的操作系统将不同于普通计算机系统.这两类操作系统的比较如表3.
　　　　　　表3　机顶盒OS与通用计算机OS比较

　机顶盒OS计算机OS
实时性很好好　
扩展性差　好　
稳定性很好较好
开放性差　好　


　　在机顶盒上采用的操作系统都是实时嵌入式操作系统，目前主要有两类不同的方式，一类是采用通用的由第3方提供的操作系统，如VRTX(Microtec)，pSOS(Integrated Systems, Inc.)，OS-9(Microware Systems Co.)，VxWorks(Wind River Systems, Inc.)，甚至Win CE(Microsoft)等现成的操作系统.采用这种做法实现机顶盒的如IBM，Philips以及LSI，等等.图10是Philips机顶盒的软件结构.采用这种方式的优点是系统具有相对较强的开放性，可以比较方便地加入新的应用.目前的趋势是将应用层软件建立在中间件(middle ware)的基础上.这几年在中间件方面，OpenTV,PowerTV以及NCI等成为中间件的主流，这些中间件的一个共同特点是支持DAVIC建议中的大多数功能.机顶盒作为未来计算技术应用的重要领域，Java的跨平台优势是不言而喻的，因此Java也不会放弃在这一领域的潜在应用，SUN将在1999年6月公布其为这种中间件应用而开发的Java TV API，基于Java的系统软件结构如图11.


图10　Philips机顶盒的软件结构


图11　基于Java的机顶盒软件结构
　　采用这种明确的层次结构，使得整个系统的软件结构清晰，具有较好的扩展性，并可以提供除电视节目收视之外更多的其他功能，同时便于应用软件的移植.但这样的缺点也是明显的，最终用户必须为软件支付较高的费用，而在这些软件所提供的功能中有很多并非用户所需要的，例如在单向有线网的条件下，用户并不需要任何基于有线网的回传功能.
　　而实际上由于消费类产品功能较为单一，因此完全可以采用相对简单的实时OS微内核，在微内核中提供包括存储管理、进程管理、中断管理以及设备管理等必要的功能，并在此基础上提供支持特定解码任务的API，如解码、解复用等功能，最后将应用软件建立在微内核和解码API的基础上.图12是具有这类微内核的基于ST20的DVB接收机的典型软件结构.


图12　基于ST20的机顶盒软件结构
7　几种典型的机顶盒结构
　　这一节给出几种典型的机顶盒设计.我们首先考虑IBM建议的一种设计，如图13所示，在IBM建议的设计中提供了用于控制的CPU Power PC 403GC、用于MPEG-2音视频解码的IBM CD20/21以及用于外围接口的IBM STBP，其中　STBP是专为STB应用设计的接口芯片，其功能包括通用I/O接口、PWM、I2C、Smart Card以及IR等，中央处理器Power PC 403GC可以对STBP按存储器方式寻址.在IBM推荐的设计中不包括信道解码部分，所以需要根据应用的要求采用其他信道解码模块.


图13　IBM建议的机顶盒信源处理部分结构
　　图14是Philips机顶盒的结构.在该结构基础上，Philips在Cable的信道解码方面将TDA 8790，TDA 8046和SAA 7207集成在一块芯片上构成单片的信道解码芯片TDA 8047，同时在回传信道上提供TDA 8050 QPSK调制芯片.在信源解码上，Philips将SAA7206，SAA7205和PR3001集成构成SAA7214，完成单片解复用和控制器的功能，同时将MPEG-2音视频解码芯片SAA 7201和视频编码芯片SAA 7183集成构成SAA 7215，并最终将全部信源处理部分集成在单片上构成SAA 7230.


图14　Philips机顶盒结构
　　图15是ST建议的典型结构.与ST结构类似的还有LSI等，在LSI生产的芯片中采用单片L 64704(与STV 0199功能类似)实现卫星信道解码，L 64008(与ST20功能类似)处理系统控制和TS流解码，L 64005(与STi 3520A功能类似)进行MPEG-2音视频码流的解码.对于采用QAM调制的Cable数字节目LSI则采用L 64768(与STV 0197功能类似)进行QAM解调和FEC处理.目前ST已经推出了集ST20，STi 3520和STV0118功能为一体的STi 55XX系列芯片，实现了单片的后端系统.


图15　ST建议的机顶盒结构
　　图16是Intel设计的机顶盒Whiteriver的主要部分，与前面采用专用芯片的思路不同，借助其在CPU上的优势，Intel的实现策略是以Pentium II为核心，大量采用软件实现.与IBM类似，Intel在信道部分采用第3方的产品，在信源部分通过引入两块交换芯片MGCH(MPEG/Graphic UMA Video/Audio Control Hub)和TCH(Tranport I/O CA Control Hub)完成对数据流向的控制.


图16　Intel Whiteriver机顶盒的信源处理部分结构
8　机顶盒对计算技术的影响
　　从上述几种典型的芯片和机顶盒结构中不难看出机顶盒的发展已对计算技术和半导体技术产生了深刻的影响.
　　首先在计算模型方面，由于在机顶盒中大量涉及音、视频的解码操作，其本质是典型的数字信号处理运算，由于这些操作的计算量很大，而实际芯片又受到主频的限制，因此并行技术是解决这一问题的唯一途径.而且在这些操作中运算模式规整，因此可以充分发挥并行处理的优越性.实际上所有的MPEG-2视音频解码器都大量地采用了并行处理技术，这里主要的并行手段是处理过程中的流水线，如第4节中讨论的视频解码过程就是这种流水线的典型.
　　其次由于机顶盒类的产品对体积、成本、可靠性等方面非常敏感，因此几乎所有生产这类芯片的IC制造商都在提高集成度上下功夫，这样大大地促进了单片系统(system on chip)技术的发展，这些单片系统一般都集成了包括RISC处理器、MPEG-2音视频解码器等在内的功能模块，同时还提供了大量专用的外设接口.除了前面提到的ST生产的STi55XX系列外，NEC从1999年初开始推出与STi55XX功能相当的uPD61030芯片，而这一芯片在图形功能上更为强大.就连IBM也在将图13中的信源解码和视频编码部分集成构成其新的芯片STB1000.由此可见，机顶盒技术大大地促进了单片系统的发展.
　　不仅如此，这些单片系统芯片的研制和生产还大大地刺激了数字、模拟混合处理芯片的发展.典型的是在这些芯片中同时包含了处理数字计算的解码和控制模块，以及进行D/A转换的视频编码模块，如STi 55XX，STB 1000以及uPD61030等芯片.目前，随着应用软件系统的不断完善，这些芯片在计算和图形方面的能力也大大提高，从最初的单纯解码，只支持单个运动图像平面加一个2bpp的图形平面，发展到24bpp、多达5个视平面(包括背景、静止图像、OSD、光标和解码运动图像平面)、同时支持子图像解码、动态缩放等功能.
　　此外，其他一些技术如片内倍频大大得益于集成锁相环、分数分频等技术的成熟，采用这些技术可以只在片外提供一个较低频率的时钟源，直接产生片内所需的各种不同频率的时钟.以STi 3520A为例，仅从片外提供一个27MHz的时钟，就可以产生包括高达243MHz频率在内的多个不同时钟频率.这种技术的优点是方便了硬件系统的设计和加工，同时大大提高了系统的抗干扰能力，并减少了系统对外的辐射.
9　Web浏览与其他功能扩展
　　与用于数字电视接收的机顶盒目的不同，另有一大类机顶盒的主要目的是进行Web的浏览，如Web TV，这类机顶盒的价格不菲.实际上传统的用于收看模拟电视的机顶盒由于在计算和显示上的能力很弱，因此不能胜任进行Web浏览的需要.由于目前用于数字电视节目接收的机顶盒至少都有一个具有较强能力的处理器，通常计算能力都在50MIPS左右，同时其OSD的显示能力也已达到256色或更高，因此在计算和显示上已基本能够满足进一步功能扩展的要求，完全具备了进行Web浏览的条件.实际上Web TV类的机顶盒也在逐步扩展其在电视收视方面的功能，如在Microsoft新近推出的Web TV中就已加入了数字电视接收的功能.值得注意的是，新一代的机顶盒除了以往的接口之外多数还要求具有IEEE 1394，USB，Modem等接口，因此用于接收电视节目的机顶盒在Internet方面的扩展是其今后发展的重要方向.此外由于传统上的电视占有很宽的信道资源，因此基于这种宽带通信的数据服务包括利用Cable上网、进行个人通信都将是机顶盒重要的功能扩展.
10　结　　论
　　机顶盒是计算机和消费类电子技术发展的必然结果，同时也将反过来促进上述技术的进步.由于计算能力和显示能力的提高，机顶盒还可以方便地实现游戏机等功能，因此未来机顶盒必然会成为融数字电视接收、DVD播放、Web浏览和游戏机功能于一体的设备.■
基金项目：本课题得到“九五”攻关项目“MPEG-2实现技术”的资助(项目编号96-B07-3).
作者简介：陈熙霖，男，1965年10月生，博士，副教授，主要研究领域为图像理解、模式识别与图像处理、多模式人机接口、数据压缩系统以及虚拟现实等.
　　　　　高文，男，1956年4月生，教授，博士生导师，现任中国科学院计算技术研究所所长，国家“八六三”计划智能计算机主题专家组组长(首席专家)，联想中央研究院院长，主要研究领域为人工智能应用和多媒体技术，侧重于计算机视觉、模式识别与图像处理、多媒体数据压缩、多模式接口以及虚拟现实等.
作者单位：陈熙霖（哈尔滨工业大学计算机系　哈尔滨　150001)
　　　　　高文（哈尔滨工业大学计算机系　哈尔滨　150001　中国科学院计算技术研究所　北京　100080）
参考文献：
［1］Digital Audio-Visual Council, DAVIC Specification, Part 1～Part 14, 1994-1998
［2］EN 300 421, Digital Broadcasting Systems for Television, Sound and Data Services: Framing Structure, Channel Coding and Modulation for 11/12 GHz Satellite Services. 1994
［3］EN 300 429 V1.2.1, Digital Broadcasting Systems for Television, Sound and Data Services: Framing Structure, Channel Coding and Modulation for Cable Systems. 1994
［4］EN 300 468, Digital Broadcasting Systems for Television, Sound and Data Services: Specification for Service Information (SI) in Digital Video Broadcasting (DVB) Systems. 1997
［5］EN 300 744, Framing Structure, Channel Coding and Modulation for Digital Terrestrial Television (DVB-T). 1997
［6］Advanced Television Systems Committee, ATSC Digital Television Standard. 1995
［7］ISO/IEC 13818-2, Coding of Moving Pictures and Associated Audio ―Part 2: Video. 1994
［8］ISO/IEC 13818-3, Coding of Moving Pictures and Associated Audio ―Part 3: Audio. 1994
［9］Advanced Television Systems Committee, Digital Audio Compression Standard(AC-3).95
［10］ISO/IEC 13818-1, Coding of Moving Pictures and Associated Audio ―Part 1: Systems. 1994
收稿日期：1999-04-08
修稿日期：1999-04-20
