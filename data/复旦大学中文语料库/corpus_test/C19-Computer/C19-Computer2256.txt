计算机应用研究
APPLICATION RESEARCH OF COMPUTERS
2000　Vol.17　No.5　P.9-10，14



基于CAD系统的协同设计研究
薛安荣　陈天滋
摘  要  文中讨论了基于CAD系统的协同设计的有关问题，提出了基于语义共享、客户/服务器模式，支持同步和异步合作的协同设计模型，并具体说明了模型中各个层次的功能。
关键词  CSCW  CAD  协作代理
1  引言
　　随着CAD技术的应用和推广，CAD系统已得到广泛应用，设计的工程项目也越来越多、越来越大，使用和参加的人数也呈上升趋势。对于一个由多人参加共同设计的工程项目，采用单用户CAD系统已不能满足设计需要，设计者之间不能通过系统进行信息沟通和信息共享，以至造成重复设计、数据不一致和反复拷贝等情况，影响了工程设计质量和进度。因此设计支持群体工作的协同CAD系统非常必要。而随着计算机技术、网络技术和分布技术的发展，计算机应用正从单用户工作模式向多用户协同工作的方向发展。计算机支持的协同工作(CSCW：Computer Supported Cooperative Work)的发展适应了信息社会中人们工作方式中的群体性、交互性、分布性和协作性特点，因此被认为是未来社会中广泛采用的技术。开发支持多用户协同工作的CAD系统，以满足越来越多的产品设计的需求是CAD系统再次开发的一个发展方向。本文对协同CAD系统设计中的有关技术作了探讨，提出了基于语义协作共享、客户/服务器结构，具有同步和异步设计方式的协作模型。
2  协作设计模型
　　为了支持群体的协同工作，CSCW系统必须具备通信、用户协作与操作协调等基本功能[1]。协同CAD系统是CSCW系统的一种，因此也应具有上述功能。我们认为协同CAD系统应具有如下功能：
　　．支持单用户CAD系统的基本功能。协同CAD系统首先应具有模型设计的基本功能，而这些正是单用户CAD系统所具有的功能。由于大多数用户对单用户系统已经习惯，因此，在协同CAD系统设计中应充分考虑个体工作方式与群体工作方式的无缝性(Seamlessness)和平滑性(Continuity)[2]。所谓无缝性是指习惯于单用户设计的用户能够容易地适应多用户设计的风格，即合作机制的增加不会给用户操作和使用带来不便；而平滑性是指用户有足够的设计自由度，即设计者可以根据需要和喜好来选择个人设计和合作设计。
　　．支持多用户协同设计。这是协同CAD系统区别于单用户CAD系统的地方。系统应支持多用户并行设计、协同完成设计任务。协同的核心是信息共享，而信息共享的基础是通信。系统应以分布式系统为基础，以信息共享和协作感知为核心，支持用户协作和操作协调。
　　．强大的数据库支持功能。协作规则、共享信息、用户信息、系统信息等数据的管理，应通过数据库管理来实现，数据管理功能的好坏直接影响着系统的性能。而现有的数据库技术又比较成熟，功能也很强大。提供数据库支持能力，可提高整个系统的协作管理能力，维护数据的一致性。
　　．开放性和可扩充性强。将协作机制和协作规则分开[１]，协作规则由用户决定，从而使系统协调更加灵活、方便。提供与其它系统或应用连接功能，可拓宽系统的应用，实现系统间数据共享、相互利用。此外还应提供扩充接口，以便将来进行扩充和再次开发。
2.1  系统结构
　　CSCW系统以分布式系统为基础，但又不同于传统的分布式系统。分布式系统是面向系统的，追求透明性，即让用户在使用分布式系统时，感觉好像独占该系统的所有资源，屏蔽了其他用户的动作；而CSCW系统则是面向用户的，追求非透明性，即系统尽可能地让所有用户互相察觉到彼此的所有操作。CSCW系统常用全分布式和集中分布式两种结构。全分布式结构的特点是：无服务器，各机器处于对等状态，合作系统和共享信息在每台计算机上均有一个拷贝，并发和访问控制在各计算机之间完成，任何一台计算机上的操作都被广播到系统的其它所有计算机上。这种结构的最大缺点是由于多副本(系统的多副本，共享信息的多副本)而使得一致性难以保证，资源浪费严重，而广播易造成网络拥塞。集中分布式结构的特点是：有客户机和服务器之分，界面程序在每台客户机上均有一个拷贝，共享信息和信息管理部分只在服务器上有一个拷贝，客户机与服务器间传输的是对于共享信息的操作命令和返回结果，客户机间需要传送各用户的操作，而操作的结果由各客户机上的交互部分自行产生。通过单个副本的集中控制，有效解决了共享信息的不一致性问题，克服了多副本造成的资源浪费问题；但由于共享信息全部置于服务器，由于客户机对共享信息的访问而增加了网络信息传输量，因此要求高性能的通信网。基于上述特点，系统结构结合了集中分布式和全分布式的优点，采用客户/服务器结构模式。即将共享信息和协作信息置于服务器上，而将常用信息置于客户机上，这样既可减少网络信息流量，又易于维护数据的一致性。具体结构如图1所示。客户机上包含二个层次：界面管理层和协作代理层。服务器上也包含两个层次：通信管理层和协同管理层。

图1系统结构
2.2  界面管理层
　　提供具体的交互设计界面和协作显示。交互设计界面的风格应与单用户设计界面相类似，以保证设计的无缝性。设计界面还应支持协作设计和协同显示功能。为此界面应提供两种设计方式(个人设计方式和合作设计方式[３])以保证设计的平滑性。在设计中设计者有角色之分，如组长和成员，因此设计界面也应有所区别。个人设计方式是一种异步合作方式，其合作是隐式的，仅是设计数据的共享，相互之间通过共享设计成果来实现隐式合作。合作设计方式是一种同步合作，要求协同感知合作者的设计活动，合作者之间工作在同一个工作区中，设计者的活动要及时传递到合作者的计算机上，同时对合作者传递过来的操作活动和设计数据应实时显示，以达到你见即我所见(WYSIWIS：What you see is what I see)。严格的WYSIWIS要求能够感知到合作者屏幕上的光标移动[４]，同步粒度细，但界面显示频繁，易产生眼花缭乱的感觉，同时显示时间增加，降低了设计速度，而且在屏幕上总是见到其他用户的光标移动会分散用户的注意力。权衡利弊，我们降低了同步共享粒度，提出了基于语义共享的群体感知。由于每一客户机上具有相同的协作管理程序和界面程序，因此将设计命令作为公共的协作语言，群体感知基于每一完整的设计命令，而不是基于每一操作，客户机间基于语义共享[5]，协作代理之间通过公共语言(设计命令语言)进行信息交换[6]。因此设计中只有当一条设计命令结束时，才将这一条完整的命令传递给合作者。如果设计者中途取消设计命令，则该命令就不需要传递给合作者。这样可减少网络信息传输量。协作感知信息通过服务器转发，并且在服务器上有完整的记录，当有新用户进入合作区时，服务器将合作区中的完整记录发送给新近进入的客户机协作代理，以便新用户了解当前合作区中的设计进展情况。
2.3  协作代理层
　　协作代理层(如图2所示)是客户机上的核心部分。主要完成数据处理和消息处理。

图2协作代理
　　在个人设计方式下，其合作方式是异步合作方式，用户之间没有操作上的协作，因此不需要群体感知的处理。协作代理控制访问请求的流向，将访问请求转换为访问消息，发送到本地信息管理程序或服务器。然后将返回的访问结果经过转换处理后交给界面程序。为了减少网络信息传输量，尽可能将访问请求引至本地数据库。因为常用信息存放在本地数据库，所以这样可大大减少对服务器的访问次数，从而减轻了网络负担。设计结果要存入服务器以便实现数据共享。
　　合作设计方式是一种同步设计方式，最显著的特征就是群体感知。群体感知包含两个方面：一方面要让合作用户感知到自身的设计过程；另一方面要感知到合作者的设计情况。因此协作代理中设计了群体感知处理和群体感知表现。其功能如下：
　　．群体感知处理   由事件驱动程序捕获操作设计命令，并将捕获的设计命令格式化为给定的消息格式，然后将消息发送到服务器上，由服务器通过广播的方式转发给合作用户。
　　．群体感知表现   接收由服务器传送来的合作用户的操作消息，并将消息转换为设计命令，转换时借助于语义规则库进行语义检查，然后交给界面管理程序驱动相应的命令进行显示。
2.4  通信管理层
　　通信管理主要完成消息的收发工作，包括用户连接的建立与拆除、请求的响应、消息的接收、分析处理和定向发送。消息的发送方式有点对点和广播两种。
2.5  协同管理层
　　协同管理是整个系统的核心，驻留在服务器上，完成用户身份的验证、职责分配、权限管理以及数据管理。当用户注册进入系统或进入合作区时，首先由身份验证机制根据身份规则进行身份验证， 然后分配职责并赋予权限，在退出合作区或系统时，要注销，以便更新有关信息。数据管理包括数据的存储和访问、并发控制、一致性保证、完整性控制、错误恢复等。服务器上存放了共享信息库、系统库、用户信息库、协作规则库等。
2.6 模型特点
　　系统结构吸取了全分布式结构与集中分布式结构的优点，使得数据易于管理和控制，数据的一致性也得到了保证；将常用数据存放在客户机上，减轻了网络负担，同时数据的访问速度也得到了提高。基于语义的协作共享，虽然降低了共享协作粒度，但减轻了网络负担，同时减少了界面更新显示次数，因而可节省显示时间，忽略某些细节的共享可使设计者集中注意力进行设计。个人和合作设计方式的支持为设计者提供了方便，与单用户CAD系统相似的设计界面，使得无缝性和平滑性得以解决。协作机制与协作规则分开使得协作更加灵活。
3 协同设计实例
　　协同商业CAD系统提供了与传统单用户CAD系统相类似的模型设计界面，设计了四个设计工具：构件设计工具、配套设计工具、小区设计工具和店堂设计工具。此外还包含效果图和动画生成工具，熟悉AutoCAD和3D Studio(3D MAX)的用户能很快适应本系统。在协同设计上采用了客户/服务器结构，将协作信息、设计产品和系统信息存放在服务器上，而将标准模型库和中间设计数据存放在客户机上，每一客户机上都有完整的界面程序。系统中提供了角色定义功能、任务协调功能、协作感知功能等。
4 结束语
　　本文提出了一个支持基于CAD系统协同设计的一般模型，并已进行了一些探索性的研究。由于单用户CAD系统已经相当完善，系统的种类也很多，如何将现有的单用户CAD系统扩充为支持多用户协同设计的CAD系统，使之更接近自然合作设计环境，这是我们将要进一步探讨的问题。例如，一个设计项目一般先由总负责人召集有关人员进行方案讨论，然后进行任务分解分配，再进行分组实施，实施中间可能还要进行会议讨论。协同设计就是要尽可能地减少人为工作，而由系统来解决，这样可减少人为因素，使协作更加科学化、合理化。并可减少设计时间、缩短设计周期、提高合作效率。
本文获国家九五重点科技攻关项目资助(A95-03-06)
薛安荣(江苏理工大学计算机科学系  镇江 212013)
陈天滋(江苏理工大学计算机科学系  镇江 212013)
参考文献
1，王国意, 徐光佑. CSCW支撑平台的结构模型. 计算机学报, 1997, 20(7): 718～724
2，朱海滨, 蔡开裕, 樊爱华等. 分布式系统原理与设计. 长沙: 国防科技大学出版社, 1997
3，Reinhard W, Schweitzer J, Volksen G. CSCW Tools: Concepts and Architectures. Computer, l994，27(5): 37～46
4，周之英, 全 波. 支持协同工作的CASE工具的实现技术. 计算机研究与发展, 1998, 35(3): 224～228
5，Gisi, Mark A., Sacchi.Co-CAD: A Collaborative Mechanical CAD System. PRESENCE, 1994, 3(4): 341～350
6，林守勋, 林宗楷, 郭玉钗等. 多Agent协同工作环境MACE. 计算机学报, 1998, 21(2): l88～193
收稿日期：1999-11-3
