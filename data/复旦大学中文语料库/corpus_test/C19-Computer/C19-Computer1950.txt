微型机与应用
MICROCOMPUTER & ITS APPLICATIONS
1999年 第18卷 第1期 Vol.18 No.1 1999



用单片机实现HT―12D的解码功能
梁华为　周旭
　　摘　要：通过分析HT―12D专用解码芯片的工作原理，说明了用8051单片机实现解码器功能的方法。
　　关键词：8051单片机　HT―12D解码芯片　编码　解码　HT―12E编码芯片
　　专用编解码芯片已广泛应用于火灾报警控制系统、安全防盗系统及其它一些测控系统中。HT―12D是HOLTEK公司生产的专用解码芯片，它与HT―12E专用编码芯片配套使用。我们在TA2000型火灾报警控制系统中使用了HT―12E/HT―12D专用编/解码芯片。在使用中，笔者觉得这类编/解码芯片有2方面的缺陷：一是要对编/解码芯片的工作频率进行匹配，而编/解码芯片的工作频率由外接电阻电容决定，由于电阻和电容的精度较低且易受工作环境(如：温度、湿度等)变化的影响，使得编/解码芯片工作频率的偏差无法控制。当这种偏差超过一定范围时，就会使解码芯片不能正确地接收数据。二是编/解码芯片往往要占用较多单片机I/O口资源，或者需要设计复杂的接口电路。
　　用单片机实现解码器功能只需占用1位I/O口，不但节省了单片机的I/O口资源，还可实现解码对编码器的自动频率跟踪，大大提高传输的准确性。在系统中，解码单元数量较多，常有几百甚至几千个，而且解码单元分布在控制对象附近，要求其体积尽量小，用单片机实现解码功能可以充分利用单片机资源、简化电路设计、减小电路板面积、降低系统成本。
1　HT―12E/HT―12D的工作原理
　　HT―12E/HT―12D专用编/解码芯片是采用CMOS工艺制作的大规模集成电路，其管脚排列如图1。

图1　管脚分布
　　HT―12E接通电源后处于等待状态，Dout输出高电平，当接收到1个有效的允许发送信号(14脚TE为低电平)时，HT―12E开始传送周期。在传输期间，HT―12E把12个输入端的输入信号经编码由Dout串行输出。Dout端输出编码脉冲的顺序依次为A0～A7、D0～D3，每个传送周期Dout输出4个完全相同的地址、数据编码脉冲串，每个脉冲串包括2个段：引导段和数据段，如图2。数据段中每位地址、数据的逻辑状态的表示如图3。

图2　传输数据格式


图3　数据逻辑状态
　　HT―12D接通电源后处于等待状态，Din有低电平出现时，开始1个接收过程。HT―12D接收HT―12E发送的代码时，把前8位作为地址，后4位作为数据，经4次接收，3次检验，如果接收到的地址与解码器的地址一致，则将4位数据锁存到D0～D3输出端，同时，VT脚输出高电平，表示接收到有效数据。HT―12D的内部结构如图4。

图4　HT-12D内部结构
2　单片机实现
　　以目前使用较为广泛的8051系列单片机为例，说明用单片机实现解码器的方法。解码单元参考电路如图5。


图5　解码单元原理图
　　编码器发出的编码信号到达解码单元后，经整形、变换后接到8051单片机的第12脚(INT0)。单片机内部编程为允许外部中断0，触发方式为边沿触发(下降沿)，设置定时/计数器0工作于定时方式1，定时器启动条件为TR0&INT0，使定时器0对INT0的高电平时间进行计数。这样，当传输开始后，第1个被计数的是引导段的1/3位高电平，以此计数值的1.5倍作为标准，把此后的计数值和此标准进行比较，若计数值大于标准值，则认为接收到0，反之，则认为接收到1。由于引导段在每个字的每次发送之前都有，所以判断标准被随时更新以适应当前传输，这就实现了频率的自动跟踪，避免了因传输频率的变动而影响数据接收的准确性，提高了系统的稳定性。
　　数据接收主要在中断0程序中实现，中断程序框图如图6。主程序中进行初始化时，置接收次数不小于12。另外，主程序中，除完成其它功能外，应检测“接收数据有效”标志，若该标志有效，则从接收缓冲区中读取数据，并复位该标志。


图6　TO中断软件流程
　　该技术已应用于我们研制的“TA2000智能型模拟量火灾报警控制系统”中，并取得了很好效果。实践证明采用该技术既避免了频率匹配难的问题，又克服了因阻容元件易受环境因素影响而造成系统工作不稳定的问题，提高了系统的可靠性。
　　该技术同样适用于MC145026/7/8和VD5026/7/8等编/解码芯片。
作者单位：中国科学院合肥智能所(230031)
参考文献
　1　张凯.MCS―51单片机综合系统及其设计开发.北京：科学出版社，1996
　2　HOLTEK公司.数据手册.1997
(收稿日期：1998-07-27)
