计算机应用研究
APPLICATION RESEARCH OF COMPUTERS
2000 Vol.17 No.3 P.27-29




基于公共网络的虚拟专用网探析
范志荣　陈文元　张卫平
摘　要：虚拟专用网VPN是一个新的网络热门技术，它可替代专线而利用公共网络进行网络互联，在减轻企业费用的同时还带来了数据安全性的保证。讨论了VPN 的分类、隧道技术和QoS问题，并提出要充分利用我国的163/169等公共骨干网建设VPN，同时，要注意加密算法安全方面的自主权。
关键词：VPN 隧道协议 QoS 安全
1　概述
　　Telecommunications杂志评出的1998年电信行业十大热门技术之一就有虚拟专用网络VPN(Virtual Private Network)；Infonetics Research公司的研究人员预计,到2001年，虚拟专用网产品、系统集成和服务的市场将达到119亿美元，每年的增长率将超过100%。因此，VPN正受到各大网络设备制造商、网络服务提供者NSP(Network Service Provider)、企业集团和许多专业人员的密切关注。
　　VPN业务作为一种能大幅减少网络开销，减轻企业负担，并提高网络生产效率的有效方法，成为替代以前远程接入企业内部网必须用专线的传统做法的时日已为期不远。因为企业IT主管所关心的是：既要有效降低网络费用，更要保证企业敏感数据的安全性、私有性和完整性。VPN正是一种满足这种要求的解决方案，它在公共网络(如Internet)上开辟出了一条专用通道供封装后的数据包通过，并使用加密、认证和访问控制等方法来保证数据的安全。因此，它可以替代专线，把公司的移动雇员、远程分支机构、供应商和商业合作伙伴连接到公司总部的内部网。VPN的简单配置示意图如图1。

图1　VPN简单配置
　　VPN的访问方法可以多种多样，包括模拟拨号、ISDN、xDSL、Cable Modem和专线。VPN也可以利用IP网络、帧中继网络FR(Frame Relay)和ATM网络来建设。具有和专线网络同样的可靠性、安全性、可管理性等特点，除此之外，还有高效、易扩展等特点。
2　VPN的分类
　　根据VPN所起的作用，可以将VPN分为三类：VPDN、Intranet VPN和Extranet VPN。
2.1　VPDN(Virtual Private Dial Network)
　　在远程用户或移动雇员和公司内部网之间的VPN，称为VPDN。远程用户利用本地的网络服务提供商NSP登录到Internet，与公司内部网之间建立隧道后收发信息，就像在公司内部办公一样，不仅省去了远程长途拨号费和专用网络设备建设维护费,而且,由于Internet无处不在,访问也就显得更加简便易行。
　　由于远程用户不一定接受过专门的训练，所以，VPDN的客户端配置应尽量简单，其实现对用户来说应该是透明的，而在NSP的拨号服务器和公司总部的边界路由器(或网关)处的VPN设备进行相应的配置。
　　VPDN的实现过程如下所述：用户拨号NSP的网络访问服务器NAS(Network Access Server)，发出PPP连接请求，NAS收到呼叫后,在用户和NAS之间建立PPP链路；然后，NAS对用户进行身份验证，确定是否是VPDN用户，如是，就启动VPDN功能，否则，视为普通的Internet用户；身份鉴别通过后，NAS启动和公司总部VPN服务器的隧道连接，VPN服务器可对由NAS传来的用户身份信息进行再次的验证，以确保只有正确授权的用户才能访问公司的内部资源。
2.2　Intranet VPN
　　在公司远程分支机构的LAN和公司总部LAN之间的VPN，称为Intranet VPN。通过Internet这一公共网络将公司在各地分支机构的LAN连到公司总部的LAN，以便公司资源共享、方便文件传达、提高办公效率，也节省了以前FR、DDN等专线所带来的高额费用。
　　由于分支机构和总部的局域网可以认为是可信的，因此，Intranet VPN主要的安全重点在于：保护公司的内联网不受外部的入侵和保证公司的敏感数据流经Internet时的安全性。基于以上考虑，有必要在两端LAN边界的VPN服务器上加强加密和认证的措施，并设置防火墙进行数据包的过滤。现在，当建立新的分支机构局域网时，可以很容易地连上因特网，因此，Intranet VPN 的互连就显得很方便，其建设时间短、成本低的特性，作为那些大型企业集团的网络解决方案尤为适合。
2.3　Extranet VPN
　　在供应商、商业合作伙伴的LAN和公司的LAN之间的VPN，称为Extranet VPN。由于不同公司网络环境的差异性，Extranet VPN应能兼容不同的操作平台和协议。
　　由于并不能保证外联网的用户都具有完全的可信性,除了一般的安全规则外,公司的网络管理员还应该设置特定的访问控制列表 ACL(Access Control List),根据访问者的身份、网络地址等参数来确定他所相应的访问权限，开放部分资源而非全部资源给外联网的用户。如对安全需要要求更高的公司，可在公司局域网设置两层防火墙，把局域网放在第二层防火墙后面，两层防火墙的中间区域即所谓的非军事区DMZ(Demilitarized Zone)，把VPN服务器和其它一些可以公开的服务器(如WWW服务器、Email服务器等)放在DMZ区,黑客即使攻破第一层防火墙,还要通过VPN服务器的验证以及第二层防火墙的过滤，因此，很难到达公司内部资源网。
3　VPN的隧道协议
　　VPN区别于一般网络互联的关键在于隧道的建立，然后，数据包经加密后，按隧道协议进行封装、传送以确保安全性。一般，在第二层-数据链路层-实现数据封装的协议叫第二层隧道协议，常用的有PPTP、L2F、L2TP；同样，在第三层-网络层-实现数据封装的协议叫第三层隧道协议，常用的有IPSec；除此之外，在TCP层实现数据安全的有SOCKS v5协议。下面分别作一简要介绍。
3.1　PPTP(Point-to-Point Tunneling Protocol)
　　1996年，Microsoft和Ascend等在PPP协议的基础上开发了PPTP，它集成于Windows NT Server 4.0 中，Windows NT Workstation和Windows 9.x也提供相应的客户端软件，因而，对于使用Microsoft操作系统的用户来说，不仅免费而且操作使用方便。
　　PPTP支持多种网络协议，可把IP、IPX、AppleTalk或NetBEUI的数据包封装在PPP包中，再将整个报文封装在PPTP隧道协议包中，最后，再嵌入IP报文或帧中继或ATM中进行传输。PPTP提供流量控制，减少拥塞的可能性，避免由包丢弃而引发包重传的数量，改善了网络的性能。PPTP的加密方法采用Microsoft点对点加密(MPPE: Microsoft Point-to-Point Encryption)算法, 可以选用相对较弱的40位密钥或强度较大的128 位密钥。由于PPTP只在隧道建立时对用户进行认证，对VPDN用户尤为适合。
3.2　L2TP(Layer 2 Tunneling Protocol)
　　1996年，Cisco提出L2F(Layer 2 Forwarding)隧道协议，它也支持多协议，但其主要用于Cisco的路由器和拨号访问服务器。1997年底，Microsoft和Cisco公司把PPTP协议和L2F协议的优点结合在一起，形成了L2TP协议。L2TP同PPTP一样，支持多协议，利用公共网络(如IP网、FR网、ATM网)封装PPP帧，可以实现和企业原有非IP网的兼容。还继承了PPTP的流量控制，支持MP(Multilink Protocol)，把多个物理通道捆绑为单一逻辑信道。L2TP使用PPP可靠性发送(RFC1663)实现数据包的可靠发送。L2TP隧道的建立在两端VPN服务器之间采用口令握手协议CHAP来验证对方的身份(其后不验证)，可采用IPSec对数据包加密传送，以保证安全。L2TP受到了许多大公司的支持。
3.3　IPSec(Internet Protocol Security)
　　IPSec是IETF(Internet Engineer Task Force)正在完善的安全标准，它把几种安全技术结合在一起形成一个较为完整的体系，受到了众多厂商的关注和支持。通过对数据加密、认证、完整性检查来保证数据传输的可靠性、私有性和保密性。
　　IPSec由IP认证头AH(Authentication Header)、IP安全载荷封装ESP(Encapsulated Security Payload)和密钥管理协议组成。
　　AH协议保证了隧道中报文的完整性，它对每组IP包进行认证，防止黑客利用IP欺骗进行攻击。AH协议可采用多种认证算法，已经被定义的认证算法有散列信息认证码-消息文摘5 (HMAC-MD5：Hashed Message Authentication Code- Message Digest 5)和安全散列算法1(JMAC-SHA1：Security Hash Algorithm Version 1)。通信双方中的一方用密钥对整个IP包进行消息文摘计算，另一方用同样的密钥和算法进行计算，如果两者的结果相同，则说明数据包在传送过程中没有被改变，且可确认数据包是从持有密钥的对方发送的，因此，数据的完整性和认证安全得以保证。AH头支持IPv6协议，IPv6中的实现是强制性，而在IPv4中的实现是可选的，两者的数据报格式稍有差异。
　　ESP协议保证数据的保密性。ESP可在两种模式下运行：隧道(Tunneling)模式和传送(Transport)模式。在隧道模式下，ESP对整个IP数据包封装和加密，这样可以隐藏源和目的IP地址，从外部看不到数据包的路由过程；在传送模式下，只对IP有效数据载荷进行封装和加密，IP源和目的地址不加密传送，因此，它的安全程度不如隧道模式来得好，但其开销较小。IPSec未具体规定使用哪一种加密算法，但缺省建议使用密码分组链方式的DES算法(CBC-DES),这是一个密钥长度为56位的加密算法，对于一般的商业应用已经足够。其它加密算法可采用Triple-DES、RC4、RC5、IDEA等。由于各国政府对当地密码的法律规定、出口政策有所不同，因此，IPSec规范草案灵活的加密算法机制对于加密算法的未来扩展、适应各地政策方面的重要性是不言而喻的。ESP包头在IPv4、IPv6中的数据报格式是相同的。
　　密钥管理协议是IPSec安全协议的一个重要的组成部分，IETF规定了Internet安全协议和密钥管理协议ISAKMP(Internet Security Association and Key Management Protocol)来实现IPSec的密钥管理需求；IETF还设计了OAKLEY密钥确定协议(Key Determination Protocol)来实施ISAKMP的具体功能。这个协议在通信系统之间建立了一个安全联系，它是一个产生和交换IPSec密钥材料并协调IPSec参数的框架，并对之进行管理的协议。
　　IPSec还有一个中央组件DOI(Domain Of Interpretation),它实际上是一个存放所有IPSec安全参数的数据库，这些参数可被与IPSec服务相应的系统参考并调用。IPSec的认证、加密功能与密钥管理系统也是一种松散耦合的关系，一旦安全功能或密钥管理系统发生变化，不需要另一部分作很大的修订，就能完成整体框架的升级。
　　IPSec的安全性和灵活性为其带来了强大的生命力，对于建设局域网和局域网之间的VPN尤为适合。如美国汽车工业行动组(AIAG)建设的汽车网络交换网的隧道和安全技术就采用了IPSec，该网是目前工业界最大的IP网络之一。
3.4　SOCKs v5
　　SOCKs v5由NEC公司开发，它是建立在TCP层上的安全协议，更容易为与特定TCP端口相连的应用建立特定的隧道，可协同低级IPSec、L2TP、PPTP等一起使用。SOCKs v5能对连接请求进行认证和授权，如果通过的话，则建立代理连接并传送数据。由于代理的存在，可增加进一步的安全性、隐藏内部网络地址和拓扑结构。当同SSL协议配合使用时，可用作企业的防火墙，防止黑客通过Internet对内部主机的未授权访问。通常用作Extranet VPN。虽然SOCKs v5提供强有力的认证和访问控制方法，但整体性能较差，管理复杂，且推广使用较晚，远不如前三种协议使用广泛。但随着整体水平的提高，其应用前景还是看好。
4　VPN中的QoS
　　由于Internet是一个开放性的网络体系结构，在数据传输过程中会带来不可预测性，而有关政府部门和大型企业有时更关心的是数据传输的安全性和传输质量，因此，如何在VPN中实现QoS就显得颇为重要。
　　QoS的目标是能合理分配带宽以保证关键应用对吞吐量的需求，因此，当不同的数据类型在VPN上争夺有限的带宽时，不仅要保证各种应用同时存在，而且要各有可接受的传输效果。提供QoS保障可以采用对包进行分类、对带宽进行管理、进行流量控制，以及采用资源预留等方法。
　　．在将包加密和送入隧道前，按照一定的原则对包进行分类并标记不同的优先级，在传输过程中，可以对不同类型的包采取不同的处理方式，按一定的优先级传送。在尚未过渡到IPv6之前，采用MPLS (Multi-Protocol Label Switching)或DiffServ (Differentiated Services)保证QoS不失为一种办法。
　　．带宽管理就是在一定信道的情况下，自动分配不同的子信道给按一定原则组织起来的包，并进行排队管理、优先级管理。
　　．流量控制用来预防VPN隧道发生过度的拥塞而引起包丢弃之后发生大量的数据包重传。
　　．RSVP(Resourse Reservation Protocol)：从现在163/169骨干网上未充分利用的带宽中划出一部分来为一些有安全需要的单位如：国家部委和政府机关提供QoS保障。
5　VPN的应用
　　由于VPN的成本低、安全而又灵活，支持未来扩展等特性，它已经引起广泛的关注，随着协议标准、产品的不断成熟，也将引起一轮更为广泛的应用。
　　从我国的网络的发展情况来看，由于中国公用计算机互联网(俗称163)和中国公众多媒体互联网(俗称169)已经初具规模。163网，遍布除台湾外的32个省；169网也在全国20多个省互连。两者的骨干网大部分都达到了155M，拨号用户和专线用户日渐增多，网络应用如电子商务、网络购物、网上银行、网上拍卖、网上证券等如雨后春笋。继1998年底启动的政府上网后，1999年又将推出企业上网和家庭上网，其中许多应用将涉及到安全方面的内容,而且163/169的网络规划目标中也有发展VPN数据增值业务的服务内容。1999年2月8 日，国内商用公共网络的两大运营商之一吉通公司在北京宣布，吉通公司将以金桥网络优质的接入服务与集成服务，与Cisco的软硬件设备相结合，推出VPN业务。因此，个人、企业用户协同网络服务提供商在这样一种良好的氛围中,如何利用好这一现有的资源(特别是作为我国自有的多媒体网络169更能保护资源的安全性)，以实现个人访问的方便，企业成本降低、工作效率提高，NSP扩展业务、增加利润等对各方都有利的服务作相应的策略调整就显得很有必要。
6　结束语
　　基于公共网络的虚拟专用网方兴未艾,其市场前景相当广阔。在我们关注技术发展的同时，也要追踪世界优秀产品的特点，结合我国的国情，生产出有我国自主知识产权的产品。特别是VPN中很关键的加密算法，要根据本部门的实际情况进行选择，对安全性要求很高的特殊机构，应选择我国自有的加密算法。国内网络设备厂商在机遇和挑战面前，应能抓住机会。
范志荣(上海交通大学信息存储研究中心 国家教委薄膜与微细技术部门开放实验室 上海 200030)
陈文元(上海交通大学信息存储研究中心 国家教委薄膜与微细技术部门开放实验室 上海 200030)
张卫平(上海交通大学信息存储研究中心 国家教委薄膜与微细技术部门开放实验室 上海 200030)
参考文献
1 Tom Novlle. VPN: Key to Convergence. Telecommunications. Vol.33, No.1, 1999. P26～28
2 Mark Tuomenoka. Virtual Private Networks: The Big Payoff. Telecommunications. Vol.32, No.11, 1998. P55～57
3 http://www.data.com/tutorials/bullet.html
4 http://www.ietf.org/internet－drafts
5 冯运波等. 虚拟专用网技术. 电子科技导报, 1998(8), P2～6
收稿日期：1999年9月19日
