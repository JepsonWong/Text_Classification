���ѧ��
Journal of Software
2000 Vol.11 No.1 P.126-132



����VLIW�ṹ�ϵ�ѭ��������������
�ݺ첨����־��
ժ��Ҫ����������ǲ��д���Ļ�������.����ָ��,VLIW(very long instruction word)���е���������ʹ����������Է����������ڲ�ͬ���ص�.ͬһ����ϵ�������γ�һ�����򼯺�,������ϵ����������֮��Ҳ���ڰ�����ϵ.�ݴ�,���һ������VLIW������ѭ�������������صķ���.�÷������걸��,����ȥ�������������������,�Ӷ�����ѭ�����ȵĸ���.���¸����ж������Ͷ�����������ĳ�ֱ�Ҫ����,�Լ�������������Ը��Ӷȵ��㷨.���ַ��������ձ�����,����ΪVLIW�������ˮ�Ͷ�ָ�������ȵĻ���.
�ؼ��ʡ�VLIW(very long instruction word),ѭ������,�������,ѭ��,����.
��ͼ������š�TP338
Eliminate Redundant Loop-Carried Flow Dependences for VLIW Architectures
RONG Hong-bo��TANG Zhi-zhong
(Department of Computer Science and Technology��Tsinghua University��Beijing��100084)
Abstract��Data dependence is the basic guideline and constraint for parallel processing. The structural distinctiveness of VLIW (very long instruction word), i.e., the lockstep property, leads to remarkable uniqueness in its data dependence analysis, as is shown in this paper. Flow dependences with the same iteration distance comprise a linear ordered set, while characteristic flow dependences with different iteration distances may also have inclusion relationship between each other. From such discovery, a novel method is presented to eliminate redundant loop-carried flow dependences for VLIW architectures, so as to facilitate loop scheduling. The method is complete in that it gets rid of all redundancies. The sufficient and necessary preconditions to identify redundancy for single and multiple iteration distances are given, and a linear ordered algorithm is described. The method is generic, and can serve as a foundation for research on VLIW, such as software pipelining and multi-instruction stream scheduling.
Key words��VLIW (very long instruction word), loop scheduling, data dependence, loop, redundancy.
������������ǲ��д���Ļ�������.�й���������Է����ĳɹ���Ȼ�ܶ��1,2��,�������VLIW(very long instruction word)��һ�ض��ṹ�Ĺ�����δ����.Ŀǰ,��VLIW�Ͻ��в���ѭ������,�������ˮ,����ʹ�ô�ͳ�Ļ�������������������Է���������3,4��,ȱ����VLIW��ר���о�.�����Ľ�˵��,����VLIW�ṹ�ϵ�������,����������ط���������ڲ�ͬ���ص�.
������ο���ѭ�����Ĳ�������VLIW�о����ȵ�.Ӱ��ѭ�����ȵĹؼ�����������������,�����������.���Ľ������ڵ���ѭ��ʱ��������������������,�Խ��͵��ȵĸ�����.
�������������¼����ٶ�.
����(1) ���д�����/���ܵ�Ԫ��������ʽ����.����VLIW�Ļ���������3,4��.
����(2) һ������һ����ָ��.ע������ٶ�û�п��Ƕ����ڲ���,�縡������,���Ⲣ��Ӱ��������ȷ��.ͨ��,�����ڲ��������ÿղ����ֲ�.����,��OPi��OPj����������,�ֱ���ҪTi��Tj������,�����OPi��OPj��ֱ����Ti��1��Tj��1���ղ���,����ΪOPi��������һ���ղ�����OPj���.
����(3) ͬһѭ�����еĲ���������Թ̶���λ��.������һ����,���ĵĽ��ֻ��ֱ���������ͼ�е�ǿ��ͨ��(Ϊ��С������������֤���ȵء����ܵص���,�������б����֮ǰȷ��).��һ���������Ժ���о�����������.
����һ���,һ���������ͼDDG(data dependence graph)���ж�����,ÿ����������ж�������.�ȷֱ�����ÿ������ϵ�����,�ٽ������������������,��һ����������,���Ǳ��ĵĻ���˼��.�������һЩ��������ͽ���,����A,B,A1,A2,...,An��ʾ����أ�OPi��ʾһ������,i�Ǹò�����ѭ�����е����.
1 �����������ж�
��������1. ��A��һ�������,��ʾOPi��OPj����д����ϵ,���Ϊd,d�ǷǸ�����,����A��(OPi��OPj,d).
������d=0ʱ,AΪ���������,����Ϊ��������.�����ᵽ���κ������,��Ĭ��Ϊ��������,��d��1.
��������2. ���������A,B,���ֻҪ����A,B����Ȼ�õ�����,���A����B,����AB.
��������3. ���������A,B,���AB,����BA,���A,B���,����A��B.
��������4. ���������A,B,���AB,��A������B,���A�����B,����AB.
��������. ,��,�����д�����.
��������1. (ƽ������)���������A��(OPi��OPj,d),B��(OPi���OPj��,d),��i��j=i�䣭j��ʱ,A=B.
����֤��:��֤AB.��time(OP)��ʾOP��ִ��ʱ��.
������ͼ1��ʾ,ÿ�����ߴ���һ��ѭ����,�����ϵĵ�������,����������϶��µ���.���������ͬ,����˵��.

Fig.1��Traslation property
ͼ1��ƽ������
������A�õ�����,��OPj��OPi֮��ִ��,��
time(OPj)��time(OPi)��0.��(1)
���� ��������������������ʽ��һ������һ��ָ�������е�,����
time(OPi)��time(OPi��)=i-i��,��(2)
time(OPj)��time(OPj��)=j-j��.��(3)
������i��j��i�䣭j��ʱ,i��i�䣽j��j��,��ʽ(2)��ʽ(3)��time(OPi)��time(OPi��)��time(OPj)��time(OPj��),����time(OPj��)��time(OPi��)��time(OPj)��time(OPi).��ʽ(1)��time(OPj��)��time(OPi��).����OPj�佫��OPi��֮��ִ��,BҲ�õ�����.���,AB.
����ͬ���֤,BA.����A��B. 
��
�����ڸ���������,ͼ1�д���A,B�����������߶���ƽ�е�,���,����������Ϊƽ������.ƽ������˵��,��VLIW,�κ�һ�������(OPi��OPj,d),������д��(OPi��j��OP0,d),ȥ����������,���Լ�дΪ(i��j,d).��������ص���ʼ��������ֹ�����ľ���λ�ò�����Ҫ,��Ҫ�������ǵ����λ��.����ж���5.
��������5. �����A��(OPi��OPj,d),����д��(��,d),���Ц�=i��j,��Ϊ�����A������ֵ.
���������Ƶ�һ����Ҫ����.
��������1. ���������A��(��a,d),B��(��b,d),��
����(1)
����֤��:����ƽ������,���Խ������Bƽ��,ʹ֮�������A����ʼ������ͬ.��ͼ2��ʾ,��a���b���ڴ��ڡ����ں�С����3�ֹ�ϵ,�ֱ��Ӧ��AB,A��B��BA.֤����ƽ�����ʵ�֤������,����׸��.

Fig.2��Illustration of theorem 1
ͼ2������1
������ͼ2(a)��2(b)��AB��a�ݦ�b��
������ͼ2(b)��A��B��a=��b����ͼ2(a)��AB��a����b��
��
��������. ���AB������,��BA.
����֤��:AB��������a�ݦ�b��������b����aBA.
��
��������ζ��,ͬһ���d�ϵ����������,��������ֵ�Ĵ�С��������.��ͼ3��ʾ,����An�ݦ� An-1��...�ݦ�A1,��AnAn-1...A1.���,ֻҪ����An,����Ķ�����Ϊ����ɾ��.���ǳ�AnΪ���d�ϵ����������.

Fig.3��Inclusion between flow dependences with the same iteration distance
ͼ3��ͬһ����ϵ�����صİ���
��������6. ��ĳһ���d,Ψһ��Ӧ��һ������ֵ,��Ϊ��(d),��ȡֵ���£������d���������ʱ,��(d)������,����,��(d)=max����i��(��i,d)��d�ϵ�����أ�.(��(d),d)��Ϊd�ϵ����������.
�������������˵��������,�������۶��������.
2 �����������ж�
��������7. ���������A1,A2,...,An,n��1,���ֻҪ�������ǾͿ�����Ȼ������һ�������B,���A1,A2,...,An�����B,����A1��A2��...��AnB.
��������8. ���������A1,A2,...,An��B,n��1,A1��A2��...��AnB,�Ҷ���һ�����X,���A1��A2��...��AnX,�����BX,��ô,��B��A1,A2,...,An�������������,����MaxIncluded(A1,A2,...,An)��B.
��������9. ���������A1,A2,...,An,n��1,������ͨ��ƽ����β����,������һ����������һ�������B,B�������A1�����,B���յ���An���յ�,��BΪA1,A2,...,An����Ȼ����,��ΪNaturalIncluded(A1,A2,...,An)=B.
�������ж�����ʱ,��ʹÿ�����ֻ�����������������,�Կ��ܴ�������.��ͼ4��ʾ,��A,B,CΪ��ͬ����ϵ����������,��A+BNaturalIncluded(A,B)C,����C����ɾȥ.

Fig.4��Redundancy in the case of multiple iteration distances
ͼ4��������ʱ������
��������������غ���Ȼ��������ؾ�����������:
��������1. MaxIncluded(A1,A2,...,An)NaturalIncluded(A1,A2,...,An).
��������2. A1��A2+...+AnBMaxIncluded(A1,A2,...,An)B.
��������1������2����������������غ���Ȼ��������صĶ���ֱ�ӵó�.
�����������������������صķ���.
��������2. ���������A1,A2,...,An,n��1,����Ai��(��i,di),i=1,2,...,n,��MaxIncluded(A1,A2,...,An)
����֤��:��ͼ5��ʾ.ͨ��ƽ��,ʹA1,A2,...,An��β���.����A1�����ΪOPk,���������ֵ�Ķ���,���յ�ΪOPk����1,A2���յ�ΪOPk��(��1����2),...,An���յ�ΪOPk��(��1����2+...����n).��Ϊ���漰n����������,ÿ����ص��յ�����Ҫ�ͺ������һ������,����,An���յ�����Ҫ�ͺ�A1�����n������.��ô,��An���յ�������n��1������,�ڸõ㴦�Ĳ���OPk��(��1����2+...+��n)��n+1������ġ���Ȼ��A1�����OPk��ִ�еĲ���.����������ȷ���������A1,A2,...,An����������������.

Fig.5��Compute Max Included(A1,A2,...An)
ͼ5�������Max Included(A1,A2,...An)
��������,MaxIncluded(A1,A2,...,An)������ֵ��k����k��(��1+��2+...+��n)��n+1��=(��1+��2+...+��n)+n��1��
����MaxIncluded(A1,A2,...,An)�������Ȼ�Ǹ�Ai(i=1,2,...,n)�����ĺ�.
��
��������1(�Գ���). MaxIncluded(A1,A2,...,An)��MaxIncluded(Ai1,Ai2,...,Ain),����i1,i2,...,in��1,2,...,n����һ������.��MaxIncluded�Ĳ���˳������ν.
��������2. ���������X��(��x,d)��Y��(��y,d),�Լ�����һ�������A1,A2,...,An,n��0,��
����(1) ��x�ݦ�yMaxIncluded(X,A1,A2,...,An)MaxIncluded(Y,A1,A2,...,An)��
����(2) ��x����yMaxIncluded(X,A1,A2,...,An)MaxIncluded(Y,A1,A2,...,An)��
����(3) ��x����yMaxIncluded(X,A1,A2,...,An)��MaxIncluded(Y,A1,A2,...,An).
��������3. �������������A1,A2,...,An��B1,B2,...,Bn,n��1,����Ai�����i�ϵ����������,Bi�����i�ϵ�����һ�������,i=1,2,...,n,��MaxIncluded(A1,A2,...,An)MaxIncluded(B1,B2,...,Bn).
������������������������صĻ���˼��,����Ҫ�����ɽ�С����ϵ������,����һ���ϴ�����ϵ������.���ֻҪ������Щ��С����ϵ�����ؼ���,�ϴ�����ϵ��Ǹ�����ؾ��������(��ͼ4��ʾ).
������һ�����d,�����Ѿ�����������������ʱ������������������ɾ����ֻʣ���������������,����Ϊ��.��������2,����������ҵ�һЩ�����A1,A2,...,An,ʹMaxIncluded(A1,A2,...,An)��,��ô,ֻҪ����A1,...,An,�Ϳ���ɾ����,�Ӷ�d�ϵ���������ض���ɾ��.
��������,����ҪѰ�ҵ�A1,A2,...,An����Ψһ.��Ϊͬһ���d���Էֽ�Ϊ�������d1,d2,...,dn֮��,���ַֽ��ǲ�Ψһ��.ÿһ��ֽ�d1,d2,...,dn����Ӧ��һ�����������A1,A2,...,An,�Ӷ���Ӧ��һ����ͬ��MaxIncluded(A1,A2,...,An).
��������,Ϊ���ж����d�ϵ������Ƿ�����ȫ������,��Ҫ�ҵ�d�����зֽ�,�Ӷ��ҵ����е�MaxIncluded(A1,A2,...,An).��ЩMaxIncluded����ͬһ���d,���,����֮��һ��Ҳ�����ų�����,���Ƕ��������е������(������������MaxIncluded���Ǹ�MaxIncluded)Ϊ���d�ϵ�����������,������d.
����������������ʱ�������ж�����.
��������3. �������d�ϵ���������ئ��Լ�d�ϵ�������������d,���ҽ�����d��ʱ,���d�ϵ���������ؿ��Ա�ɾ��.
����֤��:��������ؿ��Ա�ɾ��,����˵��������ئѿɱ�ɾ��.
����(1) �����.����d��ʱ,���ݦ�d�Ķ���,һ������ĳЩ�����A1,A2,...,An,����Ai��(��i,di),i=1,...,n,��di=d,ʹ��MaxIncluded(A1,A2,...,An)��.���,����A1,A2,...,An����,�ѿɱ�ɾ��.
����(2) ��Ҫ��.���ڦѿɱ�ɾ��,��ζ�Ŵ���ĳЩ�����A1,A2,...,An,ʹ��A1+A2+...+An��,����Ai��(��i,di),i=1,...,n,��di=d.������2,��MaxIncluded(A1,A2,...,An)��.���ɦ�d�Ķ���,��d��MaxIncluded(A1,A2,...,An).�д�����,����,��d��.
��
�������,�ڶ����������,Ҫ��ĳ�����d�ϵ������,��Ҫ�����d.����,�������Ƶ���d�Ĺ�ʽ.
��������4. �������d,��d=(��,d),���Ц�=max����1+1+��2,��1+1+��(��(d��d1))��(��1,d1)�����d1�ϵ����������,d1=1,2,...,d��1��(��2,d2)�����d2�ϵ����������,��d1+d2��d��.
����֤��:��Ȼ,��d�������d.����Ҫ������ֵ��.
�����ɦ�d�Ķ���,��(��d)=max����(MaxIncluded(A1,A2,...,An))��Ai��(��i,di)�������,i=1,...,n,n��1,��di=d��.����2������3˵��,��A1,A2,...,An�������������ʱ,MaxIncluded������ֵ�����,������ǿ��Խ�һ���ٶ�A1,A2,...,An�������������.
�����ɶ���2,MaxIncluded(A1,A2,...,An)=(��i+1)-1,d.����,��(MaxIncluded(A1,A2,...,An))=
�������,��(��d)=max(��1��1����(��i+1)-1.
������n=2ʱ,��(��d)=max��(��1+1)+(��2+1)-1��=max��(��1+1)+��2��.
������n��2ʱ,��(��d)=max��(��1+1)+��(MaxIncluded(A2,...,An))��=max��(��1+1)+max(��(MaxIncluded(A2,...,An)))��=max��(��1+1)+��(��(d-d1))��.d1��d�ķֽ��е�һ����,����d��d1,����d1��ȡֵ��Χ��1,2,...,d��1.ע��,����һ���ݹ�ʽ.
�������,��n���������,�Ц�=max����1+1+��2,��1+1+��(��(d��d1))��.
��
��������4�����˼��㦤d�ĵݹ鷽��.Ϊ����ٶ�,������㷨���ݹ�ת��Ϊ����.
3 �� ��
��������,���Ƕ��������ͼ�ϵ�ÿ����������,����������ϵ���������أ�Ȼ����Щ����ۺϿ���,��һ������������ϵ�����.
��������Pn��m=�ۦ�ij��,����n��������,m����������ϵ�����ظ��������ֵ.��ij�����i�ϵ�һ�������(��ij,i)������ֵ.P�ĵ�i�м�¼���i�ϵ������.�����i�ϵ���������ض������릱,�����ĵ�i����δ����ʱ,��ʣ���λ�����ϣ���.
������������n=�ۦ�i��,���Ц�i=max����ij����ij�ʦ�,j=1,2,...,m��.(��i,i)�������i�ϵ����������.ֻ�������е������,ɾ��������,������ϵ����༴������.
��������������n=�ۦ�i��.����1=����,����ֵ����.
�����㷨���£�
����
����
����
����
��������㷨��ʱ��Ϳռ临�Ӷȶ���O(mn).
����������һ������.��ͼ6��ʾ,ѭ������6����������,������������,ֻʣ��1��.�ɽ��㷨��ͼ�������.


Fig.6��An example of elininating redundant loop-carried flow dependences
ͼ6�����������������ص�����
4 ʵ����
�������ѡȡ��������,����ʵ��������1.
Table 1
��1

Program��Total (intra-block) loop-carried
flow dependences��After redundancy
removal��Redundancy
rate��(��)
Product5260
Flower4175
Sift5260
Vander10280
Merge13469

�ٳ���,��(�������ڵ�)������������,��ɾ��������������������,�������.
����,�������ָ���������ռ��������صİٷֱ�.�ɱ��п��Կ���,ƽ�������ԼΪ69��.��Ҫ��ԭ����ÿ��������ж�������,�����ֻ����һ��.������VLIW���е�����������ɵ�.����ּ�����VLIW������ط����Ļ�������.����ʵ�����ڻ�������,���ǽ����Ľ�����ν����Ľ���ƹ㵽һ��.
5 ������
����������������Լѭ�����ȵĸ�������,Ȼ������ÿ���������ض���Ҫ����.������Щ����Ҫ�����,�����ڼ���ѭ�����ȵĸ���.VLIW���е��������ʵ���������������ط���������ڲ�ͬ���ص�.�ݴ�,���������һ����������ķ���,�������ж������Ͷ�����������ĳ�ֱ�Ҫ�����Լ�������������Ը��Ӷȵ��㷨.
��Ȼ��������VLIW�ϵ�ѭ������Ϊ�����㿼�ǵ�,����,�����еķ������̿��Կ���,���ַ���ʵ������һ��һ�㻯�ķ���,����������ѭ��,�ʿ���ΪVLIW�������ˮ�Ͷ�ָ�������ȵĻ���.�����һ����������Ҫ�����ۺ�Ӧ�ü�ֵ.���ǽ����������о���Щ�����Ӧ��.
�����о��õ�������Ȼ��ѧ����(No.69773028)������
�ݺ첨���廪��ѧ�������ѧ�뼼��ϵ��������100084��
��־�ң��廪��ѧ�������ѧ�뼼��ϵ��������100084��
E-mail: ronghb@mail.cic.tsinghua.edu.cn
�ο�����
1��Kai Hwang. Advanced Computer Architecture: Parallelism, Scalability, Programmability. New York: McGraw-Hill, Inc., 1993.457��496
2��Psarris K, Kong X, Klappholz D. Direction vector I unit_test. IEEE Transactions on Parallel and Distributed Systems, 1993,4(11):1280��1290
3��Rau B R, Fisher J A. Instruction-Level parallel processing: history, over view and perspective. The Journal of Supercomputing, 1993,1(9):9��50
4��Lam M. Software pipelining: an efficient scheduling technique for VLIW machines. SIGPLAN Notices, 1988,23(7):318��328
1998-12-01�ո�
1999-02-01�޸�
